{"ast":null,"code":"import React,{useEffect,useMemo,useRef,useState}from\"react\";import'./style.css';// style.cssã‚’å†åº¦æœ‰åŠ¹åŒ–\nimport{nowInSec,SkyWayAuthToken,SkyWayContext,SkyWayRoom,SkyWayStreamFactory,uuidV4,RemoteDataStream,// RemoteDataStreamã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ\nRemoteVideoStream,// RemoteVideoStreamã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ\nRemoteAudioStream// RemoteAudioStreamã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ\n}from'@skyway-sdk/room';/**\r\n * ãƒ›ãƒ¼ãƒ ç”»é¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ\r\n * @param {object} props - ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£\r\n * @param {function} props.setIsLoggedIn - ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’è¨­å®šã™ã‚‹é–¢æ•°\r\n */import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Home(_ref){let{setIsLoggedIn}=_ref;// ãƒ«ãƒ¼ãƒ å\nconst[roomName,setRoomName]=useState(\"\");// è‡ªåˆ†ã®å‚åŠ è€…æƒ…å ± (ãƒ«ãƒ¼ãƒ ã«å‚åŠ ã™ã‚‹ã¨è¨­å®šã•ã‚Œã¾ã™)\nconst[me,setMe]=useState(null);// SkyWayã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹\nconst[skywayContext,setSkywayContext]=useState(null);// SkyWayãƒ«ãƒ¼ãƒ ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹\nconst[skywayRoom,setSkywayRoom]=useState(null);// ãƒªãƒ¢ãƒ¼ãƒˆãƒ“ãƒ‡ã‚ªè¦ç´ ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®Map (memberId -> videoElement)\nconst remoteVideoElements=useRef(new Map());// ãƒªãƒ¢ãƒ¼ãƒˆãƒ“ãƒ‡ã‚ªã‚’è¡¨ç¤ºã™ã‚‹DOMè¦ç´ ã¸ã®å‚ç…§\nconst robotDisplayRef=useRef(null);// ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®å‚ç…§ã‚’ä¿æŒ\nconst localStreamRef=useRef(null);// å—ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®çŠ¶æ…‹\n// src/home.js\n// eslint-disable-next-line no-unused-vars\nconst[receivedMessages,setReceivedMessages]=useState([]);// é€ä¿¡ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®å‚ç…§ã‚’ä¿æŒ\nconst localDataStreamRef=useRef(null);// LocalDataStreamã®å‚ç…§ã‚’ä¿æŒ\n// ãƒžã‚¤ã‚¯ã®çŠ¶æ…‹ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®çŠ¶æ…‹ (ãƒŸãƒ¥ãƒ¼ãƒˆçŠ¶æ…‹ã‚’ç®¡ç†)\nconst[isMuted,setIsMuted]=useState(false);// ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚¹ãƒˆãƒªãƒ¼ãƒ ã®Publicationã‚’ä¿æŒã™ã‚‹ãŸã‚ã®å‚ç…§\nconst audioPublicationRef=useRef(null);// AIãƒ¢ãƒ¼ãƒ‰ãŒONã‹ã©ã†ã‹ã‚’ç®¡ç†ã™ã‚‹çŠ¶æ…‹\nconst[isAiModeOn,setIsAiModeOn]=useState(false);// AIã‹ã‚‰ã®ææ¡ˆã‚’ä¿æŒã™ã‚‹çŠ¶æ…‹\n// { key: 'ai_assist_1', text: 'ææ¡ˆå†…å®¹' } ã®å½¢å¼ã§æ ¼ç´\nconst[aiSuggestions,setAiSuggestions]=useState([null,null]);// 2ã¤ã®ææ¡ˆã‚’ä¿æŒã™ã‚‹ãŸã‚ã€åˆæœŸå€¤ã‚’nullã§åŸ‹ã‚ã‚‹\n// ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ãŒé€²è¡Œä¸­ã‹ã©ã†ã‹ã‚’ç®¡ç†ã™ã‚‹çŠ¶æ…‹\nconst[isMoveInProgress,setIsMoveInProgress]=useState(false);// ç¿»è¨³ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿æŒã™ã‚‹çŠ¶æ…‹ã‚’è¿½åŠ \nconst[translatedText,setTranslatedText]=useState(\"\");// ðŸŒŸè¿½åŠ : éŸ³å£°èªè­˜ãŒå®Ÿè¡Œä¸­ã‹ã©ã†ã‹ã‚’ç®¡ç†ã™ã‚‹çŠ¶æ…‹\nconst[isListening,setIsListening]=useState(false);// ðŸŒŸè¿½åŠ : SpeechRecognitionã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‚ç…§ã‚’ä¿æŒ\nconst recognition=useRef(null);const URL=\"https://translation.googleapis.com/language/translate/v2?key=\";const apiKey='AIzaSyBBk7P0P0XCyh3p0Ov7jiP9d1n02wYk_AY';// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã®å¤šè¨€èªžãƒžãƒƒãƒ”ãƒ³ã‚°\nconst messages=useMemo(()=>({hello:{japanese:'ãƒªã‚»ãƒƒãƒˆ',english:'Hello'},goodbye:{japanese:'æ±ºã‚ãƒãƒ¼ã‚º',english:'Goodbye'},bow:{japanese:'ãƒã‚¤ãƒã‚¤',english:'Bow'},flap:{japanese:'YES',english:'Flap'},lookUp:{japanese:'NO',english:'Look up'},lookDown:{japanese:'å³æ‰‹ã‚’ä¸Šã’ã‚‹',english:'Look down'},lookRight:{japanese:'å³æ‰‹ã‚’ä¸‹ã’ã‚‹',english:'Look right'},lookLeft:{japanese:'å·¦æ‰‹ã‚’ä¸Šã’ã‚‹',english:'Left hand up'// Changed from 'Look left' for clarity\n},nod:{japanese:'å·¦æ‰‹ã‚’ä¸‹ã’ã‚‹',english:'Left hand down'// Changed from 'Nod' for clarity\n},tiltHead:{japanese:'ä¸Šã‚’å‘ã',english:'Look up'// Changed from 'Tilt head' for clarity\n},spin:{japanese:'ä¸‹ã‚’å‘ã',english:'Look down'// Changed from 'Spin' for clarity\n},jump:{japanese:'å³ã‚’å‘ã',english:'Look right'// Changed from 'Jump' for clarity\n},dance:{japanese:'å·¦ã‚’å‘ã',english:'Look left'// Changed from 'Dance' for clarity\n},bowDeep:{japanese:'ãƒ‘ã‚¿ãƒ‘ã‚¿',english:'Flap arms'// Changed from 'Deep bow' for clarity\n},doingSomething:{japanese:'ã“ã‚“ã«ã¡ã¯',english:'Hello'},thankYou:{japanese:'ãƒã‚¤ãƒã‚¤',english:'Goodbye'// Changed from 'Thank you' for clarity\n},good:{japanese:'ã‚ˆã†ã“ã',english:'Welcome'// Changed from 'Good' for clarity\n},ookini:{japanese:'ã‚ã‚ŠãŒã¨ã†',english:'Thank you (Kansai dialect)'},amazing:{japanese:'æ¥½ã—ã‚“ã§ã­',english:'Enjoy'// Changed from 'Amazing' for clarity\n},takepicture:{japanese:'å†™çœŸã¨ã‚ã†',english:'take_picture'// Changed from 'Amazing' for clarity\n},wait:{japanese:'ã¡ã‚‡ã£ã¨å¾…ã£ã¦ã­',english:'wait'// Changed from 'Amazing' for clarity\n},good:{japanese:'ã„ã„ã­',english:'good'// Changed from 'Amazing' for clarity\n},Where_are_you_from:{japanese:'ã©ã“ã‹ã‚‰ããŸã®',english:'Where_are_you_from'// Changed from 'Amazing' for clarity\n},Yes:{japanese:'ã¯ã„',english:'Yes'// Changed from 'Amazing' for clarity\n},No:{japanese:'ã„ã„ãˆ',english:'No'// Changed from 'Amazing' for clarity\n},sorry:{japanese:'ã”ã‚ã‚“ã­',english:'Sorry'// Changed from 'Amazing' for clarity\n},yourewelcome:{japanese:'ã©ã†ã„ãŸã—ã¾ã—ã¦',english:'yourewelcome'// Changed from 'Amazing' for clarity\n},name:{japanese:'ãªã¾ãˆ',english:'name'// Changed from 'Amazing' for clarity\n}}),[]);/**\r\n   * ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©\r\n   */const handleLogout=()=>{setIsLoggedIn(false);// ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’falseã«è¨­å®š\n};// SkyWay App ID ã¨ Secret Key\n// æ³¨æ„: æœ¬ç•ªç’°å¢ƒã§ã¯ã€ã“ã‚Œã‚‰ã®ã‚­ãƒ¼ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã›ãšã€\n// ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å®‰å…¨ã«æ¸¡ã™ã“ã¨ã‚’å¼·ãæŽ¨å¥¨ã—ã¾ã™ã€‚\nconst appId=useMemo(()=>\"4490dcb5-dbe8-4028-ba0a-6d0d143e4515\",[]);const secretKey=useMemo(()=>\"40HHGEIOx0BRByPdxqwUswK0a+7v2JaeaJ9CcFjMdAQ=\",[]);// SkyWayèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆ\nconst token=useMemo(()=>{if(appId==null||secretKey==null)return undefined;return new SkyWayAuthToken({jti:uuidV4(),// JWT ID\niat:nowInSec(),// ç™ºè¡Œæ™‚åˆ»\nexp:nowInSec()+60*60*24,// æœ‰åŠ¹æœŸé™ (24æ™‚é–“)\nversion:3,scope:{appId:appId,rooms:[{name:\"*\",// ã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒ åã«é©ç”¨\nmethods:[\"create\",\"close\",\"updateMetadata\"],// ãƒ«ãƒ¼ãƒ æ“ä½œã®æ¨©é™\nmember:{name:\"*\",// ã™ã¹ã¦ã®ãƒ¡ãƒ³ãƒãƒ¼ã«é©ç”¨\nmethods:[\"publish\",\"subscribe\",\"updateMetadata\"]// ãƒ¡ãƒ³ãƒãƒ¼æ“ä½œã®æ¨©é™\n}}],turn:{enabled:true// TURNã‚µãƒ¼ãƒãƒ¼ã®ä½¿ç”¨ã‚’è¨±å¯ (NATè¶Šãˆã®ãŸã‚)\n}}}).encode(secretKey);},[appId,secretKey]);/**\r\n   * SkyWayContextã®åˆæœŸåŒ–ã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’è¡Œã†useEffect\r\n   * ãƒˆãƒ¼ã‚¯ãƒ³ãŒåˆ©ç”¨å¯èƒ½ã«ãªã£ãŸã¨ãã«ä¸€åº¦ã ã‘å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚\r\n   */useEffect(()=>{if(!token)return;let currentContext;const initContext=async()=>{try{currentContext=await SkyWayContext.Create(token);setSkywayContext(currentContext);console.log(\"SkyWayContext created successfully.\");}catch(error){console.error(\"Failed to create SkyWayContext:\",error);}};initContext();// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¢ãƒ³ãƒžã‚¦ãƒ³ãƒˆæ™‚ã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç ´æ£„\nreturn()=>{if(currentContext){currentContext.dispose();console.log(\"SkyWayContext disposed.\");}};},[token]);// tokenãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã«ã®ã¿å®Ÿè¡Œ\n// ðŸŒŸè¿½åŠ : SpeechRecognition APIã®åˆæœŸåŒ–\nuseEffect(()=>{// ãƒ–ãƒ©ã‚¦ã‚¶ãŒSpeechRecognitionã«å¯¾å¿œã—ã¦ã„ã‚‹ã‹ç¢ºèª\nconst SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;if(!SpeechRecognition){console.error(\"SpeechRecognition API is not supported by this browser.\");return;}// SpeechRecognitionã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–\nrecognition.current=new SpeechRecognition();recognition.current.continuous=true;// é€£ç¶šçš„ãªèªè­˜\nrecognition.current.interimResults=true;// ä¸­é–“çµæžœã‚’è¿”ã™\nrecognition.current.lang='ja-JP';// æ—¥æœ¬èªžã‚’æŒ‡å®š\n// éŸ³å£°èªè­˜ã®çµæžœã‚’å‡¦ç†ã™ã‚‹ãƒãƒ³ãƒ‰ãƒ©\nrecognition.current.onresult=event=>{let finalTranscript='';for(let i=event.resultIndex;i<event.results.length;++i){if(event.results[i].isFinal){finalTranscript=event.results[i][0].transcript;break;// æœ€åˆã®ç¢ºå®šã—ãŸçµæžœã®ã¿ã‚’å–å¾—\n}}// ç¢ºå®šã—ãŸçµæžœãŒç©ºã§ãªã‘ã‚Œã°Skywayã§é€ä¿¡\nif(finalTranscript.trim()!==''){console.log(\"Transcription final result:\",finalTranscript);// Skywayã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ã§é€ä¿¡\nif(localDataStreamRef.current&&me){//const result = `translate_data_web:${finalTranscript}`; \nconst URL2=URL+apiKey+\"&q=\"+encodeURI(finalTranscript)+\"&source=\"+'ja'+\"&target=\"+'en';// eslint-disable-line\nlet xhr=new XMLHttpRequest();xhr.open('POST',[URL2],false);xhr.send();if(xhr.status===200){const res=JSON.parse(xhr.responseText);const res2=res[\"data\"][\"translations\"][0][\"translatedText\"];const res3=\"translate_data_web:\".concat(res2);localDataStreamRef.current.write(res3);}console.log(\"Sent transcription: \\\"\".concat(finalTranscript,\"\\\"\"));// è‡ªåˆ†ã®ç”»é¢ã«ã‚‚è¡¨ç¤º\nsetReceivedMessages(prevMessages=>[...prevMessages,{senderId:me.id,message:finalTranscript,isLocal:true}]);}}};// èªè­˜ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©\nrecognition.current.onerror=event=>{console.error(\"Speech recognition error:\",event.error);setIsListening(false);// ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒªã‚¹ãƒ‹ãƒ³ã‚°çŠ¶æ…‹ã‚’åœæ­¢\n};// èªè­˜çµ‚äº†æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©\nrecognition.current.onend=()=>{console.log(\"Speech recognition ended.\");// é€£ç¶šèªè­˜ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã€è‡ªå‹•çš„ã«å†èµ·å‹•ã•ã‚Œã‚‹ãŸã‚ã€ç‰¹åˆ¥ãªå‡¦ç†ã¯ä¸è¦\n// if (isListening) {\n//   recognition.current.start();\n// }\n};// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¢ãƒ³ãƒžã‚¦ãƒ³ãƒˆæ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\nreturn()=>{if(recognition.current){recognition.current.stop();}};},[me,localDataStreamRef]);/**\r\n   * ãƒªãƒ¢ãƒ¼ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’DOMã«è¿½åŠ ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°\r\n   * @param {RemoteVideoStream | RemoteAudioStream} stream - è¿½åŠ ã™ã‚‹ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¹ãƒˆãƒªãƒ¼ãƒ \r\n   * @param {string} memberId - ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã®ãƒ¡ãƒ³ãƒãƒ¼ID\r\n   */const attachRemoteStream=(stream,memberId)=>{if(robotDisplayRef.current&&(stream instanceof RemoteVideoStream||stream instanceof RemoteAudioStream)){// æ—¢å­˜ã®ãƒ“ãƒ‡ã‚ªè¦ç´ ãŒã‚ã‚Œã°å‰Šé™¤\nconst existingVideo=remoteVideoElements.current.get(memberId);if(existingVideo){robotDisplayRef.current.removeChild(existingVideo);remoteVideoElements.current.delete(memberId);}const video=document.createElement(\"video\");video.autoplay=true;// è‡ªå‹•å†ç”Ÿ\nvideo.playsInline=true;// ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³å†ç”Ÿ (iOSãªã©ã§å¿…è¦)\nvideo.className=\"remote-video object-cover\";// ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ç”¨ã®ã‚¯ãƒ©ã‚¹ã¨object-coverã‚’è¿½åŠ \nvideo.dataset.memberId=memberId;// ãƒ¡ãƒ³ãƒãƒ¼IDã‚’ãƒ‡ãƒ¼ã‚¿å±žæ€§ã«ä¿å­˜\nstream.attach(video);// ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ãƒ“ãƒ‡ã‚ªè¦ç´ ã®ã‚½ãƒ¼ã‚¹ã«è¨­å®š\nrobotDisplayRef.current.appendChild(video);remoteVideoElements.current.set(memberId,video);console.log(\"Attached stream from \".concat(memberId,\" to DOM.\"));}else{console.warn(\"Attempted to attach non-media stream or robotDisplayRef is null for member \".concat(memberId,\".\"));}};/**\r\n   * ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®å—ä¿¡ã‚’å‡¦ç†ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°\r\n   * @param {RemoteDataStream} stream - å—ä¿¡ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ \r\n   * @param {string} memberId - ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã®ãƒ¡ãƒ³ãƒãƒ¼ID\r\n   */const handleDataStream=(stream,memberId)=>{if(stream instanceof RemoteDataStream){stream.onData.add(data=>{console.log(\"Received data from \".concat(memberId,\":\"),data);// å—ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’çŠ¶æ…‹ã«è¿½åŠ \nsetReceivedMessages(prevMessages=>[...prevMessages,{senderId:memberId,message:data}]);// \"move_finish\" ã‚·ã‚°ãƒŠãƒ«ã‚’ãƒã‚§ãƒƒã‚¯\nif(data===\"move_finish\"){console.log(\"Received 'move_finish' signal. Enabling side panel buttons.\");setIsMoveInProgress(false);// ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†\n}// AIææ¡ˆã®ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã‚’ãƒã‚§ãƒƒã‚¯\n// æ–°ã—ã„ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ \"ai_assist_1:data:ai_assist_2:data\" ã‚’è§£æž\nconst aiCombinedSuggestionRegex=/^ai_assist_1:(.*):ai_assist_2:(.*)$/;const combinedMatch=String(data).match(aiCombinedSuggestionRegex);if(combinedMatch){const suggestion1Content=combinedMatch[1];// ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚°ãƒ«ãƒ¼ãƒ—1ãŒæœ€åˆã®ææ¡ˆ\nconst suggestion2Content=combinedMatch[2];// ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚°ãƒ«ãƒ¼ãƒ—2ãŒ2ç•ªç›®ã®ææ¡ˆ\nconsole.log(suggestion1Content);console.log(suggestion2Content);setAiSuggestions([{key:'ai_assist_1',text:suggestion1Content},// ã‚­ãƒ¼ã‚’ai_assist_1ã«ä¿®æ­£\n{key:'ai_assist_2',text:suggestion2Content}// ã‚­ãƒ¼ã‚’ai_assist_2ã«ä¿®æ­£\n]);console.log(\"Received combined AI suggestions.\");}else{// ä»¥å‰ã®å˜ä¸€ææ¡ˆãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã‚‚è€ƒæ…®ã™ã‚‹å ´åˆï¼ˆã‚‚ã—ä¸¡æ–¹ã®ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆãŒæ··åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãªã‚‰ï¼‰\nconst aiSingleSuggestionRegex=/^ai_assist_(\\d+):(.*)$/;const singleMatch=String(data).match(aiSingleSuggestionRegex);if(singleMatch){const suggestionNumber=parseInt(singleMatch[1],10);const suggestionContent=singleMatch[2];if(suggestionNumber===1||suggestionNumber===2){setAiSuggestions(prevSuggestions=>{const newSuggestions=[...prevSuggestions];newSuggestions[suggestionNumber-1]={key:\"ai_assist_\".concat(suggestionNumber),// ã‚­ãƒ¼ã‚’ai_assist_Nã«ä¿®æ­£\ntext:suggestionContent};return newSuggestions;});console.log(\"Received single AI suggestion \".concat(suggestionNumber,\".\"));}}}// æ–°ã—ã„ç¿»è¨³ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã‚’ãƒã‚§ãƒƒã‚¯\nconst translateRegex=/^translate_request:(.*)$/;const translateMatch=String(data).match(translateRegex);if(translateMatch){const translatedContent=translateMatch[1];setTranslatedText(translatedContent);// çŠ¶æ…‹ã‚’æ›´æ–°\nconsole.log(\"Received translated text: \".concat(translatedContent));}else{// ç¿»è¨³ãƒ‡ãƒ¼ã‚¿ã§ã¯ãªã„å ´åˆã€ç¿»è¨³ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ã‹ã¯è¦æ¤œè¨Ž\n// setTranslatedText(\"\");\n}});console.log(\"Listening for data from \".concat(memberId,\".\"));}else{console.warn(\"Attempted to handle non-data stream as data stream for member \".concat(memberId,\".\"));}};/**\r\n   * ãƒ«ãƒ¼ãƒ ã«å‚åŠ ã™ã‚‹ãƒãƒ³ãƒ‰ãƒ©\r\n   * SkyWayContextãŒåˆæœŸåŒ–ã•ã‚Œã€ãƒ«ãƒ¼ãƒ åãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚\r\n   */const handleJoinRoom=async()=>{if(!skywayContext){console.error(\"SkyWayContext is not initialized. Please wait or check token.\");return;}if(!roomName){console.error(\"Room name is empty. Please enter a room name to join.\");return;}if(skywayRoom&&me){console.warn(\"Already in a room. Please leave the current room first.\");return;}try{// æŒ‡å®šã•ã‚ŒãŸãƒ«ãƒ¼ãƒ åã§P2Pãƒ«ãƒ¼ãƒ ã‚’ä½œæˆã¾ãŸã¯æ¤œç´¢\nconst room=await SkyWayRoom.FindOrCreate(skywayContext,{type:\"p2p\",// P2Pãƒ«ãƒ¼ãƒ ã‚¿ã‚¤ãƒ—\nname:roomName});// roomã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª\nif(!room){console.error(\"SkyWayRoom.FindOrCreate returned null or undefined room.\");throw new Error(\"Failed to create or find SkyWayRoom.\");}setSkywayRoom(room);console.log(\"SkyWayRoom '\".concat(roomName,\"' found or created.\"));// ãƒ«ãƒ¼ãƒ ã«å‚åŠ ã—ã€è‡ªåˆ†ã®ãƒ¡ãƒ³ãƒãƒ¼æƒ…å ±ã‚’å–å¾—\nconst localMember=await room.join();// localMemberãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª\nif(!localMember){console.error(\"room.join() returned null or undefined localMember.\");throw new Error(\"Failed to join the room.\");}setMe(localMember);console.log(\"Joined room '\".concat(roomName,\"' as member ID: \").concat(localMember.id));// ãƒ«ãƒ¼ãƒ IDã¨è‡ªåˆ†ã®IDã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤º\nconsole.log(\"Room ID: \".concat(roomName,\" / My ID: \").concat(localMember.id));// è‡ªåˆ†ã®ã‚«ãƒ¡ãƒ©ã¨ãƒžã‚¤ã‚¯ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ä½œæˆã—ã€å…¬é–‹\nconst{audio,video}=await SkyWayStreamFactory.createMicrophoneAudioAndCameraStream();localStreamRef.current=video;// ãƒ­ãƒ¼ã‚«ãƒ«ãƒ“ãƒ‡ã‚ªã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ä¿å­˜\nawait localMember.publish(video);const publication_audio=await localMember.publish(audio);audioPublicationRef.current=publication_audio;// ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªPublicationã‚’ä¿å­˜\nsetIsMuted(false);console.log(\"Published local camera and microphone stream.\");// è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ä½œæˆã—ã€å…¬é–‹\nconst dataStream=await SkyWayStreamFactory.createDataStream();localDataStreamRef.current=dataStream;// ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ä¿å­˜\nawait localMember.publish(dataStream);console.log(\"Published local data stream.\");// ãƒ«ãƒ¼ãƒ å‚åŠ æ™‚ã¯ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹ã«ã™ã‚‹ï¼ˆãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã¾ã å§‹ã¾ã£ã¦ã„ãªã„ãŸã‚ï¼‰\nsetIsMoveInProgress(false);// --- æ—¢å­˜ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’è³¼èª­ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ ---\n// ãƒ«ãƒ¼ãƒ å†…ã®æ—¢å­˜ã®å…¬é–‹ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ã™ã¹ã¦è³¼èª­ã™ã‚‹\nfor(const publication of room.publications){// è‡ªåˆ†ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¯è³¼èª­ã—ãªã„\nif(localMember.id===publication.publisher.id){continue;}try{const{stream}=await localMember.subscribe(publication.id);console.log(\"Subscribed to existing stream from \".concat(publication.publisher.id,\", type: \").concat(publication.contentType));if(publication.contentType==='video'||publication.contentType==='audio'){attachRemoteStream(stream,publication.publisher.id);}else if(publication.contentType==='data'){handleDataStream(stream,publication.publisher.id);}else{console.warn(\"Unknown stream content type: \".concat(publication.contentType,\" from \").concat(publication.publisher.id));}}catch(subscribeError){console.error(\"Failed to subscribe to existing stream from \".concat(publication.publisher.id,\":\"),subscribeError);}}// --- ãƒ«ãƒ¼ãƒ ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š ---\n// ãƒ¡ãƒ³ãƒãƒ¼ãŒãƒ«ãƒ¼ãƒ ã«å‚åŠ ã—ãŸã¨ãã®ã‚¤ãƒ™ãƒ³ãƒˆ\nif(room.onMemberJoined){room.onMemberJoined.add(e=>{console.log(\"Member joined: \".concat(e.member.id));});}else{console.error(\"room.onMemberJoined is undefined. This is unexpected.\");}// ãƒ¡ãƒ³ãƒãƒ¼ãŒãƒ«ãƒ¼ãƒ ã‚’é›¢è„±ã—ãŸã¨ãã®ã‚¤ãƒ™ãƒ³ãƒˆ\nif(room.onMemberLeft){room.onMemberLeft.add(e=>{console.log(\"Member left: \".concat(e.member.id));// è©²å½“ãƒ¡ãƒ³ãƒãƒ¼ã®ãƒ“ãƒ‡ã‚ªè¦ç´ ã‚’DOMã‹ã‚‰å‰Šé™¤ã—ã€Mapã‹ã‚‰ã‚‚å‰Šé™¤\nconst videoElement=remoteVideoElements.current.get(e.member.id);if(videoElement&&robotDisplayRef.current){robotDisplayRef.current.removeChild(videoElement);remoteVideoElements.current.delete(e.member.id);console.log(\"Removed video for member \".concat(e.member.id));}// ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ é–¢é€£ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚‚ã“ã“ã«è¿½åŠ å¯èƒ½ã§ã™ãŒã€\n// onDataãƒªã‚¹ãƒŠãƒ¼ã¯ã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒé–‰ã˜ã‚‰ã‚Œã‚‹ã¨è‡ªå‹•çš„ã«åœæ­¢ã—ã¾ã™ã€‚\n});}else{console.error(\"room.onMemberLeft is undefined. This is unexpected.\");}// ã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒå…¬é–‹ã•ã‚ŒãŸã¨ãã®ã‚¤ãƒ™ãƒ³ãƒˆ\nif(room.onStreamPublished){room.onStreamPublished.add(async e=>{console.log(\"Stream published by \".concat(e.publication.publisher.id,\", type: \").concat(e.publication.contentType));// è‡ªåˆ†ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¯è³¼èª­ã—ãªã„\nif(localMember.id!==e.publication.publisher.id){try{// ãƒªãƒ¢ãƒ¼ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’è³¼èª­\nconst{stream}=await localMember.subscribe(e.publication.id);console.log(\"Subscribed to stream from \".concat(e.publication.publisher.id));if(e.publication.contentType==='video'||e.publication.contentType==='audio'){attachRemoteStream(stream,e.publication.publisher.id);}else if(e.publication.contentType==='data'){handleDataStream(stream,e.publication.publisher.id);}else{console.warn(\"Unknown stream content type: \".concat(e.publication.contentType,\" from \").concat(e.publication.publisher.id));}}catch(subscribeError){console.error(\"Failed to subscribe to stream from \".concat(e.publication.publisher.id,\":\"),subscribeError);}}else{console.log(\"Skipping subscription for own stream: \".concat(e.publication.publisher.id));}});}else{console.error(\"room.onStreamPublished is undefined. This is unexpected.\");}// ã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒéžå…¬é–‹ã«ãªã£ãŸã¨ãã®ã‚¤ãƒ™ãƒ³ãƒˆ\nif(room.onStreamUnpublished){room.onStreamUnpublished.add(e=>{console.log(\"Stream unpublished by \".concat(e.publication.publisher.id));// è©²å½“ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ãƒ“ãƒ‡ã‚ªè¦ç´ ã‚’DOMã‹ã‚‰å‰Šé™¤ã—ã€Mapã‹ã‚‰ã‚‚å‰Šé™¤\nconst videoElement=remoteVideoElements.current.get(e.publication.publisher.id);if(videoElement&&robotDisplayRef.current){robotDisplayRef.current.removeChild(videoElement);remoteVideoElements.current.delete(e.publication.publisher.id);console.log(\"Removed unpublished video for member \".concat(e.publication.publisher.id));}});}else{console.error(\"room.onStreamUnpublished is undefined. This is unexpected.\");}}catch(error){console.error(\"Failed to join room:\",error);// ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã«çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦å†è©¦è¡Œå¯èƒ½ã«ã™ã‚‹\nsetSkywayRoom(null);setMe(null);// ã‚¨ãƒ©ãƒ¼æ™‚ã«æ—¢å­˜ã®ãƒ“ãƒ‡ã‚ªè¦ç´ ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\nif(robotDisplayRef.current){Array.from(robotDisplayRef.current.children).forEach(child=>{if(child.tagName==='VIDEO'){// ãƒ“ãƒ‡ã‚ªè¦ç´ ã®srcObjectã‚’ã‚¯ãƒªã‚¢ã—ã€ãƒˆãƒ©ãƒƒã‚¯ã‚’åœæ­¢\nif(child.srcObject&&typeof child.srcObject.getTracks==='function'){child.srcObject.getTracks().forEach(track=>track.stop());child.srcObject=null;}child.remove();// DOMã‹ã‚‰è¦ç´ ã‚’å‰Šé™¤\n}});}remoteVideoElements.current.clear();if(localStreamRef.current){// LocalVideoStreamã®stop()ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™\nif(typeof localStreamRef.current.stop==='function'){localStreamRef.current.stop();console.log(\"Stopped local media stream during join error cleanup.\");}else{console.warn(\"localStreamRef.current is not a valid LocalVideoStream or stop is not a function during join error cleanup.\");}localStreamRef.current=null;}// LocalDataStreamã¯è‡ªå‹•çš„ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã•ã‚Œã‚‹ãŸã‚ã€æ˜Žç¤ºçš„ãªclose()ã¯ä¸è¦\nlocalDataStreamRef.current=null;// å‚ç…§ã‚’ã‚¯ãƒªã‚¢\nconsole.log(\"Local data stream reference cleared during join error cleanup.\");// ãƒŸãƒ¥ãƒ¼ãƒˆçŠ¶æ…‹ã‚‚ãƒªã‚»ãƒƒãƒˆ\nsetIsMuted(false);audioPublicationRef.current=null;setIsMoveInProgress(false);// ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\nsetTranslatedText(\"\");// ç¿»è¨³ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢\n}};/**\r\n   * ãƒ«ãƒ¼ãƒ ã‹ã‚‰é€€å‡ºã™ã‚‹ãƒãƒ³ãƒ‰ãƒ©\r\n   */const handleLeaveRoom=async()=>{if(skywayRoom&&me){try{// ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’åœæ­¢ã—ã€å…¬é–‹ã‚’è§£é™¤\nif(localStreamRef.current){// LocalVideoStreamã®stop()ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™\nif(typeof localStreamRef.current.stop==='function'){localStreamRef.current.stop();console.log(\"Stopped local media stream.\");}else{console.warn(\"localStreamRef.current is not a valid LocalVideoStream or stop is not a function during leave.\");}localStreamRef.current=null;}// LocalDataStreamã¯è‡ªå‹•çš„ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã•ã‚Œã‚‹ãŸã‚ã€æ˜Žç¤ºçš„ãªclose()ã¯ä¸è¦\nlocalDataStreamRef.current=null;// å‚ç…§ã‚’ã‚¯ãƒªã‚¢\nconsole.log(\"Local data stream reference cleared.\");// ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªPublicationã®å‚ç…§ã‚’ã‚¯ãƒªã‚¢\naudioPublicationRef.current=null;setIsMuted(false);// ãƒŸãƒ¥ãƒ¼ãƒˆçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\nsetTranslatedText(\"\");// ç¿»è¨³ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢\n// ï¿½è¿½åŠ : ãƒ«ãƒ¼ãƒ é€€å‡ºæ™‚ã«éŸ³å£°èªè­˜ã‚’åœæ­¢\nif(isListening){recognition.current.stop();setIsListening(false);}await me.leave();// ãƒ«ãƒ¼ãƒ ã‹ã‚‰é€€å‡º\nconsole.log(\"Left room '\".concat(roomName,\"'\"));// ãƒ«ãƒ¼ãƒ é€€å‡ºã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤º\nconsole.log(\"Left room: \".concat(roomName));// room.dispose()ã‚’ä½¿ç”¨\nif(skywayRoom){await skywayRoom.dispose();// ãƒ«ãƒ¼ãƒ ã‚’é–‰ã˜ã‚‹ (ã“ã‚Œã¯ãƒ«ãƒ¼ãƒ ã®ä½œæˆè€…ã®ã¿ãŒåŠ¹æžœçš„ã§ã™)\nconsole.log(\"SkyWay Room disposed.\");}// SkyWay SDKã«é–¢ã™ã‚‹ã™ã¹ã¦ã®æ“ä½œãŒä¸è¦ã«ãªã£ãŸå ´åˆã«context.dispose()ã‚’å‘¼ã³å‡ºã™\n// ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¢ãƒ³ãƒžã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹éš›ã«useEffectã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã§å‡¦ç†ã•ã‚Œã‚‹ãŸã‚ã€ã“ã“ã§ã¯å‘¼ã³å‡ºã•ãªã„\n}catch(error){}finally{// çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\nsetMe(null);setSkywayRoom(null);setReceivedMessages([]);// å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚ã‚¯ãƒªã‚¢\n// ã™ã¹ã¦ã®ãƒªãƒ¢ãƒ¼ãƒˆãƒ“ãƒ‡ã‚ªè¦ç´ ã‚’DOMã‹ã‚‰å‰Šé™¤\nif(robotDisplayRef.current){Array.from(robotDisplayRef.current.children).forEach(child=>{if(child.tagName==='VIDEO'){// ãƒ“ãƒ‡ã‚ªè¦ç´ ã®srcObjectã‚’ã‚¯ãƒªã‚¢ã—ã€ãƒˆãƒ©ãƒƒã‚¯ã‚’åœæ­¢\nif(child.srcObject&&typeof child.srcObject.getTracks==='function'){child.srcObject.getTracks().forEach(track=>track.stop());child.srcObject=null;}child.remove();// DOMã‹ã‚‰è¦ç´ ã‚’å‰Šé™¤\n}});}remoteVideoElements.current.clear();// AIãƒ¢ãƒ¼ãƒ‰ã‚‚ã‚ªãƒ•ã«ã™ã‚‹\nsetIsAiModeOn(false);setAiSuggestions([null,null]);// ææ¡ˆã‚‚ã‚¯ãƒªã‚¢\nsetIsMoveInProgress(false);// ãƒ«ãƒ¼ãƒ é€€å‡ºæ™‚ã‚‚ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\n}}};/**\r\n   * ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ“ä½œã™ã‚‹ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã®å‡¦ç†\r\n   * @param {string | object} messageOrKey - é€ä¿¡ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚­ãƒ¼ (messagesã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚­ãƒ¼) ã¾ãŸã¯AIææ¡ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ\r\n   */const handleSend=async messageOrKey=>{if(me&&skywayRoom&&localDataStreamRef.current){try{let messageToSend;let shouldSetMoveInProgress=false;// ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³é€²è¡Œä¸­ãƒ•ãƒ©ã‚°ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®æ–°ã—ã„å¤‰æ•°\nif(typeof messageOrKey==='string'){// ã‚µã‚¤ãƒ‰ãƒœã‚¿ãƒ³ã‹ã‚‰ã®é€ä¿¡ã®å ´åˆã€ç›´æŽ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ–‡å­—åˆ—ã‚’ä½¿ç”¨\nif(messageOrKey.startsWith(\"template_motion_\")){messageToSend=messageOrKey;shouldSetMoveInProgress=true;// ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒžãƒ³ãƒ‰ã®å ´åˆã®ã¿ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹\n}else if(messageOrKey.startsWith(\"template_voice_\")){messageToSend=messageOrKey;// ãƒœã‚¤ã‚¹ã‚³ãƒžãƒ³ãƒ‰ã®å ´åˆã¯shouldSetMoveInProgressã‚’trueã«ã—ãªã„\n}else if(messageOrKey.startsWith(\"robot_reset\")){messageToSend=messageOrKey;}else{// æ—¢å­˜ã®messagesã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã®ãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ— (AIææ¡ˆä»¥å¤–ã§ã‚­ãƒ¼ãŒæ¸¡ã•ã‚ŒãŸå ´åˆãªã©)\nmessageToSend=messages[messageOrKey];}}else if(typeof messageOrKey==='object'&&messageOrKey.key){// messageOrKey.text ã‹ã‚‰ messageOrKey.key ã«å¤‰æ›´\n// AIææ¡ˆãƒœã‚¿ãƒ³ã‹ã‚‰ã®é€ä¿¡\nmessageToSend=messageOrKey.key;// ææ¡ˆã®ã‚­ãƒ¼ï¼ˆai_assist_1ãªã©ï¼‰ã‚’é€ä¿¡\n// AIææ¡ˆã®å ´åˆã¯shouldSetMoveInProgressã‚’trueã«ã—ãªã„\n}if(!messageToSend){console.warn(\"Message to send is empty or not found.\");return;}localDataStreamRef.current.write(messageToSend);console.log(\"Sent message: \\\"\".concat(messageToSend,\"\\\"\"));// é€ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚è‡ªèº«ã®ç”»é¢ã«è¡¨ç¤º\nsetReceivedMessages(prevMessages=>[...prevMessages,{senderId:me.id,message:messageToSend,isLocal:true}]);setAiSuggestions([null,null]);// é€ä¿¡ã—ãŸã‚‰ææ¡ˆã‚’ã‚¯ãƒªã‚¢\n// shouldSetMoveInProgressãŒtrueã®å ´åˆã®ã¿ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³é€²è¡Œä¸­çŠ¶æ…‹ã«ã™ã‚‹\nif(shouldSetMoveInProgress){setIsMoveInProgress(true);}// AIææ¡ˆã‚„ãƒœã‚¤ã‚¹ã‚³ãƒžãƒ³ãƒ‰ã®å ´åˆã¯ã€isMoveInProgressã¯å¤‰æ›´ã—ãªã„\n// (ä»¥å‰ã®ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ãŒé€²è¡Œä¸­ã§ã‚ã‚Œã°ãã®ã¾ã¾ã€ãã†ã§ãªã‘ã‚Œã°falseã®ã¾ã¾)\n}catch(error){console.error(\"Failed to send data:\",error);}}else{console.warn(\"Cannot send message: Not in a room, 'me' object is not available, or data stream is not ready.\");}};/**\r\n   * ãƒžã‚¤ã‚¯ã®ãƒŸãƒ¥ãƒ¼ãƒˆ/ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãƒãƒ³ãƒ‰ãƒ©\r\n   */const handleMute=async()=>{console.log(\"start\");if(!audioPublicationRef.current){console.warn(\"Audio publication not available. Cannot toggle mute.\");return;}try{if(isMuted){// ç¾åœ¨ãƒŸãƒ¥ãƒ¼ãƒˆçŠ¶æ…‹ãªã‚‰ã€ãƒŸãƒ¥ãƒ¼ãƒˆã‚’è§£é™¤\nawait audioPublicationRef.current.enable();console.log(\"Microphone unmuted.\");}else{// ç¾åœ¨ãƒŸãƒ¥ãƒ¼ãƒˆçŠ¶æ…‹ã§ãªã„ãªã‚‰ã€ãƒŸãƒ¥ãƒ¼ãƒˆ\nawait audioPublicationRef.current.disable();console.log(\"Microphone muted.\");}setIsMuted(!isMuted);// ãƒŸãƒ¥ãƒ¼ãƒˆçŠ¶æ…‹ã‚’ãƒˆã‚°ãƒ«\n}catch(error){console.error(\"Failed to toggle microphone mute state:\",error);}};// AIãƒ¢ãƒ¼ãƒ‰ãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã«ã‚·ã‚°ãƒŠãƒ«ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã®ãƒ•ãƒ©ã‚°\nconst isInitialAiModeRender=useRef(true);/**\r\n   * AIãƒ¢ãƒ¼ãƒ‰ã®çŠ¶æ…‹å¤‰æ›´ã‚’ç›£è¦–ã—ã€ã‚·ã‚°ãƒŠãƒ«ã‚’é€ä¿¡ã™ã‚‹useEffect\r\n   */useEffect(()=>{// åˆå›žãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã¯ã‚·ã‚°ãƒŠãƒ«ã‚’é€ä¿¡ã—ãªã„\nif(isInitialAiModeRender.current){isInitialAiModeRender.current=false;return;}// me ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒåˆ©ç”¨å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª\nif(!me||!localDataStreamRef.current){return;}if(isAiModeOn){// AIãƒ¢ãƒ¼ãƒ‰ãŒONã«ãªã£ãŸã‚‰ã€AIã«ææ¡ˆã‚’è¦æ±‚ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡\nlocalDataStreamRef.current.write(\"robot_reset\");console.log(\"Sent AI_MODE_REQUEST_SUGGESTIONS signal.\");setAiSuggestions([null,null]);// æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ãŸã‚ã«ææ¡ˆã‚’ã‚¯ãƒªã‚¢\n}else{// AIãƒ¢ãƒ¼ãƒ‰ãŒOFFã«ãªã£ãŸã‚‰ææ¡ˆã‚’ã‚¯ãƒªã‚¢ã—ã€AIãƒ¢ãƒ¼ãƒ‰çµ‚äº†ã®ã‚·ã‚°ãƒŠãƒ«ã‚’é€ä¿¡\nlocalDataStreamRef.current.write(\"robot_reset\");console.log(\"Sent AI_MODE_OFF_SIGNAL.\");setAiSuggestions([null,null]);// ææ¡ˆã‚’ã‚¯ãƒªã‚¢\n}},[isAiModeOn,me,localDataStreamRef]);// isAiModeOn, me, localDataStreamRef ã®å¤‰æ›´ã«åå¿œ\n/**\r\n   * AIãƒ¢ãƒ¼ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãƒãƒ³ãƒ‰ãƒ©\r\n   * ã“ã®é–¢æ•°ã¯AIãƒ¢ãƒ¼ãƒ‰ã®çŠ¶æ…‹ã‚’ãƒˆã‚°ãƒ«ã™ã‚‹ã®ã¿ã§ã€ã‚·ã‚°ãƒŠãƒ«é€ä¿¡ã¯useEffectã«ä»»ã›ã‚‹\r\n   *//* eslint-disable */const handleAiModeToggle=()=>{setIsAiModeOn(prev=>!prev);};/* eslint-enable */// ðŸŒŸè¿½åŠ : éŸ³å£°èªè­˜ã®é–‹å§‹ãƒ»åœæ­¢ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãƒãƒ³ãƒ‰ãƒ©\nconst handleToggleListening=()=>{if(!recognition.current){console.error(\"SpeechRecognition API is not initialized.\");return;}if(isListening){// èªè­˜ã‚’åœæ­¢\nrecognition.current.stop();console.log(\"Stopped speech recognition.\");}else{// èªè­˜ã‚’é–‹å§‹\nrecognition.current.start();console.log(\"Started speech recognition.\");}setIsListening(!isListening);};return/*#__PURE__*/_jsxs(\"div\",{className:\"app-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header-left\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"motion-btn\",disabled:isAiModeOn||isMoveInProgress,children:\"\\u30E2\\u30FC\\u30B7\\u30E7\\u30F3\"}),translatedText&&/*#__PURE__*/_jsxs(\"div\",{className:\"translated-text\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"translated-text-label\",children:\"\\u7FFB\\u8A33: \"}),/*#__PURE__*/_jsx(\"span\",{className:\"translated-text-content\",children:translatedText})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"header-right\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"room-controls\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"\\u30EB\\u30FC\\u30E0\\u540D\\u3092\\u5165\\u529B\",value:roomName,onChange:e=>setRoomName(e.target.value),className:\"room-input\",disabled:!!me// ãƒ«ãƒ¼ãƒ å‚åŠ ä¸­ã¯å…¥åŠ›ä¸å¯ã«ã™ã‚‹\n}),!me?/*#__PURE__*/// ãƒ«ãƒ¼ãƒ ã«å‚åŠ ã—ã¦ã„ãªã„å ´åˆ\n_jsx(\"button\",{onClick:handleJoinRoom,className:\"join-room-btn\",disabled:!skywayContext||!roomName,children:\"\\u30EB\\u30FC\\u30E0\\u306B\\u53C2\\u52A0\"}):/*#__PURE__*/// ãƒ«ãƒ¼ãƒ ã«å‚åŠ ã—ã¦ã„ã‚‹å ´åˆ\n_jsx(\"button\",{onClick:handleLeaveRoom,className:\"leave-room-btn\",children:\"\\u30EB\\u30FC\\u30E0\\u3092\\u9000\\u51FA\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleLogout,className:\"logout-btn\",children:\"\\u30ED\\u30B0\\u30A2\\u30A6\\u30C8\"}),/*#__PURE__*/_jsx(\"button\",{className:\"voice-btn\",disabled:isAiModeOn||isMoveInProgress,children:\"\\u30DC\\u30A4\\u30B9\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"main-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"side-panel\",children:/*#__PURE__*/_jsx(\"div\",{className:\"side-panel-content\",children:Object.keys(messages).slice(0,14).map(key=>/*#__PURE__*/// å·¦å´ã®ãƒœã‚¿ãƒ³æ•°ã‚’èª¿æ•´\n_jsxs(\"button\",{// å·¦å´ã®ãƒœã‚¿ãƒ³ã¯ \"template_motion_ã€‡ã€‡\" å½¢å¼ã§é€ä¿¡\nonClick:()=>handleSend(\"template_motion_\".concat(messages[key].japanese)),className:\"side-btn\",disabled:isAiModeOn||!me||isMoveInProgress// AIãƒ¢ãƒ¼ãƒ‰ä¸­ã€æœªå‚åŠ ã€ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã¯ç„¡åŠ¹åŒ–\n,children:[messages[key].japanese,\" \"]},key))})}),/*#__PURE__*/_jsx(\"div\",{className:\"main-area\",children:/*#__PURE__*/_jsx(\"div\",{className:\"robot-display\",ref:robotDisplayRef,children:(aiSuggestions[0]||aiSuggestions[1])&&/*#__PURE__*/_jsxs(\"div\",{className:\"ai-suggestions\",children:[aiSuggestions[0]&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleSend(aiSuggestions[0]),className:\"ai-suggestion-btn\",disabled:isMoveInProgress// ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã¯ç„¡åŠ¹åŒ–\n,children:aiSuggestions[0].text}),aiSuggestions[1]&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleSend(aiSuggestions[1]),className:\"ai-suggestion-btn\",disabled:isMoveInProgress// ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã¯ç„¡åŠ¹åŒ–\n,children:aiSuggestions[1].text})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"side-panel right\",children:/*#__PURE__*/_jsx(\"div\",{className:\"side-panel-content\",children:Object.keys(messages).slice(14).map(key=>/*#__PURE__*/// å³å´ã®ãƒœã‚¿ãƒ³æ•°ã‚’èª¿æ•´\n_jsxs(\"button\",{// å³å´ã®ãƒœã‚¿ãƒ³ã¯ \"template_voice_ã€‡ã€‡\" å½¢å¼ã§é€ä¿¡\nonClick:()=>handleSend(\"template_voice_\".concat(messages[key].japanese)),className:\"side-btn\",disabled:isAiModeOn||!me||isMoveInProgress// AIãƒ¢ãƒ¼ãƒ‰ä¸­ã€æœªå‚åŠ ã€ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã¯ç„¡åŠ¹åŒ–\n,children:[messages[key].japanese,\" \"]},key))})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bottom-controls\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"control-btn ai-btn\",onClick:()=>handleAiModeToggle(),disabled:!me// ãƒ«ãƒ¼ãƒ ã«å‚åŠ ã—ã¦ã„ãªã„å ´åˆã¯ç„¡åŠ¹\n,children:isAiModeOn?'ãƒªã‚»ãƒƒãƒˆ   ':'AIãƒ¢ãƒ¼ãƒ‰ON'}),/*#__PURE__*/_jsx(\"button\",{className:\"control-btn speech-recognition-btn \".concat(isListening?'listening':''),onClick:handleToggleListening,disabled:!me||!localDataStreamRef.current||isAiModeOn// ãƒ«ãƒ¼ãƒ æœªå‚åŠ ã€ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ æœªæº–å‚™ã€AIãƒ¢ãƒ¼ãƒ‰ä¸­ã¯ç„¡åŠ¹\n,children:isListening?'ðŸ”´ éŸ³å£°èªè­˜ã‚’åœæ­¢':'ðŸŽ¤ éŸ³å£°èªè­˜ã‚’é–‹å§‹'}),/*#__PURE__*/_jsxs(\"button\",{className:\"control-btn mic-btn \".concat(isMuted?'muted':'')// ãƒŸãƒ¥ãƒ¼ãƒˆçŠ¶æ…‹ã«å¿œã˜ã¦ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ \n,onClick:handleMute,id:\"micBtn\",disabled:!me||!audioPublicationRef.current||isAiModeOn// ãƒ«ãƒ¼ãƒ ã«å‚åŠ ã—ã¦ã„ãªã„ã€ã¾ãŸã¯ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãŒå…¬é–‹ã•ã‚Œã¦ã„ãªã„ã€AIãƒ¢ãƒ¼ãƒ‰ä¸­ã¯ç„¡åŠ¹\n,children:[isMuted?'ðŸ”‡ ãƒžã‚¤ã‚¯ãƒŸãƒ¥ãƒ¼ãƒˆ':'ðŸŽ¤ ãƒžã‚¤ã‚¯ON',\" \"]})]})]});}export default Home;","map":{"version":3,"names":["React","useEffect","useMemo","useRef","useState","nowInSec","SkyWayAuthToken","SkyWayContext","SkyWayRoom","SkyWayStreamFactory","uuidV4","RemoteDataStream","RemoteVideoStream","RemoteAudioStream","jsx","_jsx","jsxs","_jsxs","Home","_ref","setIsLoggedIn","roomName","setRoomName","me","setMe","skywayContext","setSkywayContext","skywayRoom","setSkywayRoom","remoteVideoElements","Map","robotDisplayRef","localStreamRef","receivedMessages","setReceivedMessages","localDataStreamRef","isMuted","setIsMuted","audioPublicationRef","isAiModeOn","setIsAiModeOn","aiSuggestions","setAiSuggestions","isMoveInProgress","setIsMoveInProgress","translatedText","setTranslatedText","isListening","setIsListening","recognition","URL","apiKey","messages","hello","japanese","english","goodbye","bow","flap","lookUp","lookDown","lookRight","lookLeft","nod","tiltHead","spin","jump","dance","bowDeep","doingSomething","thankYou","good","ookini","amazing","takepicture","wait","Where_are_you_from","Yes","No","sorry","yourewelcome","name","handleLogout","appId","secretKey","token","undefined","jti","iat","exp","version","scope","rooms","methods","member","turn","enabled","encode","currentContext","initContext","Create","console","log","error","dispose","SpeechRecognition","window","webkitSpeechRecognition","current","continuous","interimResults","lang","onresult","event","finalTranscript","i","resultIndex","results","length","isFinal","transcript","trim","URL2","encodeURI","xhr","XMLHttpRequest","open","send","status","res","JSON","parse","responseText","res2","res3","concat","write","prevMessages","senderId","id","message","isLocal","onerror","onend","stop","attachRemoteStream","stream","memberId","existingVideo","get","removeChild","delete","video","document","createElement","autoplay","playsInline","className","dataset","attach","appendChild","set","warn","handleDataStream","onData","add","data","aiCombinedSuggestionRegex","combinedMatch","String","match","suggestion1Content","suggestion2Content","key","text","aiSingleSuggestionRegex","singleMatch","suggestionNumber","parseInt","suggestionContent","prevSuggestions","newSuggestions","translateRegex","translateMatch","translatedContent","handleJoinRoom","room","FindOrCreate","type","Error","localMember","join","audio","createMicrophoneAudioAndCameraStream","publish","publication_audio","dataStream","createDataStream","publication","publications","publisher","subscribe","contentType","subscribeError","onMemberJoined","e","onMemberLeft","videoElement","onStreamPublished","onStreamUnpublished","Array","from","children","forEach","child","tagName","srcObject","getTracks","track","remove","clear","handleLeaveRoom","leave","handleSend","messageOrKey","messageToSend","shouldSetMoveInProgress","startsWith","handleMute","enable","disable","isInitialAiModeRender","handleAiModeToggle","prev","handleToggleListening","start","disabled","placeholder","value","onChange","target","onClick","Object","keys","slice","map","ref"],"sources":["C:/banpaku_2025/banpaku_web_Another-version/src/home.js"],"sourcesContent":["\r\nimport React, { useEffect, useMemo, useRef, useState } from \"react\";\r\nimport './style.css'; // style.cssã‚’å†åº¦æœ‰åŠ¹åŒ–\r\nimport {\r\n  nowInSec,\r\n  SkyWayAuthToken,\r\n  SkyWayContext,\r\n  SkyWayRoom,\r\n  SkyWayStreamFactory,\r\n  uuidV4,\r\n  RemoteDataStream, // RemoteDataStreamã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ\r\n  RemoteVideoStream, // RemoteVideoStreamã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ\r\n  RemoteAudioStream, // RemoteAudioStreamã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ\r\n} from '@skyway-sdk/room';\r\n\r\n/**\r\n * ãƒ›ãƒ¼ãƒ ç”»é¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ\r\n * @param {object} props - ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£\r\n * @param {function} props.setIsLoggedIn - ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’è¨­å®šã™ã‚‹é–¢æ•°\r\n */\r\nfunction Home({ setIsLoggedIn }) {\r\n  // ãƒ«ãƒ¼ãƒ å\r\n  const [roomName, setRoomName] = useState(\"\");\r\n  // è‡ªåˆ†ã®å‚åŠ è€…æƒ…å ± (ãƒ«ãƒ¼ãƒ ã«å‚åŠ ã™ã‚‹ã¨è¨­å®šã•ã‚Œã¾ã™)\r\n  const [me, setMe] = useState(null);\r\n  // SkyWayã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹\r\n  const [skywayContext, setSkywayContext] = useState(null);\r\n  // SkyWayãƒ«ãƒ¼ãƒ ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹\r\n  const [skywayRoom, setSkywayRoom] = useState(null);\r\n  // ãƒªãƒ¢ãƒ¼ãƒˆãƒ“ãƒ‡ã‚ªè¦ç´ ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®Map (memberId -> videoElement)\r\n  const remoteVideoElements = useRef(new Map());\r\n  // ãƒªãƒ¢ãƒ¼ãƒˆãƒ“ãƒ‡ã‚ªã‚’è¡¨ç¤ºã™ã‚‹DOMè¦ç´ ã¸ã®å‚ç…§\r\n  const robotDisplayRef = useRef(null);\r\n  // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®å‚ç…§ã‚’ä¿æŒ\r\n  const localStreamRef = useRef(null);\r\n  // å—ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®çŠ¶æ…‹\r\n  // src/home.js\r\n  // eslint-disable-next-line no-unused-vars\r\n  const [receivedMessages, setReceivedMessages] = useState([]);\r\n  // é€ä¿¡ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®å‚ç…§ã‚’ä¿æŒ\r\n  const localDataStreamRef = useRef(null); // LocalDataStreamã®å‚ç…§ã‚’ä¿æŒ\r\n  // ãƒžã‚¤ã‚¯ã®çŠ¶æ…‹ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®çŠ¶æ…‹ (ãƒŸãƒ¥ãƒ¼ãƒˆçŠ¶æ…‹ã‚’ç®¡ç†)\r\n  const [isMuted, setIsMuted] = useState(false);\r\n  // ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚¹ãƒˆãƒªãƒ¼ãƒ ã®Publicationã‚’ä¿æŒã™ã‚‹ãŸã‚ã®å‚ç…§\r\n  const audioPublicationRef = useRef(null);\r\n  // AIãƒ¢ãƒ¼ãƒ‰ãŒONã‹ã©ã†ã‹ã‚’ç®¡ç†ã™ã‚‹çŠ¶æ…‹\r\n  const [isAiModeOn, setIsAiModeOn] = useState(false);\r\n  // AIã‹ã‚‰ã®ææ¡ˆã‚’ä¿æŒã™ã‚‹çŠ¶æ…‹\r\n  // { key: 'ai_assist_1', text: 'ææ¡ˆå†…å®¹' } ã®å½¢å¼ã§æ ¼ç´\r\n  const [aiSuggestions, setAiSuggestions] = useState([null, null]); // 2ã¤ã®ææ¡ˆã‚’ä¿æŒã™ã‚‹ãŸã‚ã€åˆæœŸå€¤ã‚’nullã§åŸ‹ã‚ã‚‹\r\n  // ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ãŒé€²è¡Œä¸­ã‹ã©ã†ã‹ã‚’ç®¡ç†ã™ã‚‹çŠ¶æ…‹\r\n  const [isMoveInProgress, setIsMoveInProgress] = useState(false);\r\n  // ç¿»è¨³ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿æŒã™ã‚‹çŠ¶æ…‹ã‚’è¿½åŠ \r\n  const [translatedText, setTranslatedText] = useState(\"\");\r\n  // ðŸŒŸè¿½åŠ : éŸ³å£°èªè­˜ãŒå®Ÿè¡Œä¸­ã‹ã©ã†ã‹ã‚’ç®¡ç†ã™ã‚‹çŠ¶æ…‹\r\n  const [isListening, setIsListening] = useState(false);\r\n  // ðŸŒŸè¿½åŠ : SpeechRecognitionã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‚ç…§ã‚’ä¿æŒ\r\n  const recognition = useRef(null);\r\n\r\n  const URL = \"https://translation.googleapis.com/language/translate/v2?key=\";\r\n  const apiKey = 'AIzaSyBBk7P0P0XCyh3p0Ov7jiP9d1n02wYk_AY';\r\n  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã®å¤šè¨€èªžãƒžãƒƒãƒ”ãƒ³ã‚°\r\n  const messages = useMemo(() => ({\r\n    hello: {\r\n      japanese: 'ãƒªã‚»ãƒƒãƒˆ',\r\n      english: 'Hello'\r\n    },\r\n    goodbye: {\r\n      japanese: 'æ±ºã‚ãƒãƒ¼ã‚º',\r\n      english: 'Goodbye'\r\n    },\r\n    bow: {\r\n      japanese: 'ãƒã‚¤ãƒã‚¤',\r\n      english: 'Bow'\r\n    },\r\n    flap: {\r\n      japanese: 'YES',\r\n      english: 'Flap'\r\n    },\r\n    lookUp: {\r\n      japanese: 'NO',\r\n      english: 'Look up'\r\n    },\r\n    lookDown: {\r\n      japanese: 'å³æ‰‹ã‚’ä¸Šã’ã‚‹',\r\n      english: 'Look down'\r\n    },\r\n    lookRight: {\r\n      japanese: 'å³æ‰‹ã‚’ä¸‹ã’ã‚‹',\r\n      english: 'Look right'\r\n    },\r\n    lookLeft: {\r\n      japanese: 'å·¦æ‰‹ã‚’ä¸Šã’ã‚‹',\r\n      english: 'Left hand up' // Changed from 'Look left' for clarity\r\n    },\r\n    nod: {\r\n      japanese: 'å·¦æ‰‹ã‚’ä¸‹ã’ã‚‹',\r\n      english: 'Left hand down' // Changed from 'Nod' for clarity\r\n    },\r\n    tiltHead: {\r\n      japanese: 'ä¸Šã‚’å‘ã',\r\n      english: 'Look up' // Changed from 'Tilt head' for clarity\r\n    },\r\n    spin: {\r\n      japanese: 'ä¸‹ã‚’å‘ã',\r\n      english: 'Look down' // Changed from 'Spin' for clarity\r\n    },\r\n    jump: {\r\n      japanese: 'å³ã‚’å‘ã',\r\n      english: 'Look right' // Changed from 'Jump' for clarity\r\n    },\r\n    dance: {\r\n      japanese: 'å·¦ã‚’å‘ã',\r\n      english: 'Look left' // Changed from 'Dance' for clarity\r\n    },\r\n    bowDeep: {\r\n      japanese: 'ãƒ‘ã‚¿ãƒ‘ã‚¿',\r\n      english: 'Flap arms' // Changed from 'Deep bow' for clarity\r\n    },\r\n    doingSomething: {\r\n      japanese: 'ã“ã‚“ã«ã¡ã¯',\r\n      english: 'Hello'\r\n    },\r\n    thankYou: {\r\n      japanese: 'ãƒã‚¤ãƒã‚¤',\r\n      english: 'Goodbye' // Changed from 'Thank you' for clarity\r\n    },\r\n    good: {\r\n      japanese: 'ã‚ˆã†ã“ã',\r\n      english: 'Welcome' // Changed from 'Good' for clarity\r\n    },\r\n    ookini: {\r\n      japanese: 'ã‚ã‚ŠãŒã¨ã†',\r\n      english: 'Thank you (Kansai dialect)'\r\n    },\r\n    amazing: {\r\n      japanese: 'æ¥½ã—ã‚“ã§ã­',\r\n      english: 'Enjoy' // Changed from 'Amazing' for clarity\r\n    },\r\n     takepicture: {\r\n      japanese: 'å†™çœŸã¨ã‚ã†',\r\n      english: 'take_picture' // Changed from 'Amazing' for clarity\r\n    },\r\n    wait: {\r\n      japanese: 'ã¡ã‚‡ã£ã¨å¾…ã£ã¦ã­',\r\n      english: 'wait' // Changed from 'Amazing' for clarity\r\n    },\r\n    good: {\r\n      japanese: 'ã„ã„ã­',\r\n      english: 'good' // Changed from 'Amazing' for clarity\r\n    },\r\n    Where_are_you_from: {\r\n      japanese: 'ã©ã“ã‹ã‚‰ããŸã®',\r\n      english: 'Where_are_you_from' // Changed from 'Amazing' for clarity\r\n    },\r\n    Yes: {\r\n      japanese: 'ã¯ã„',\r\n      english: 'Yes' // Changed from 'Amazing' for clarity\r\n    },\r\n    No: {\r\n      japanese: 'ã„ã„ãˆ',\r\n      english: 'No' // Changed from 'Amazing' for clarity\r\n    },\r\n    sorry: {\r\n      japanese: 'ã”ã‚ã‚“ã­',\r\n      english: 'Sorry' // Changed from 'Amazing' for clarity\r\n    },\r\n    yourewelcome: {\r\n      japanese: 'ã©ã†ã„ãŸã—ã¾ã—ã¦',\r\n      english: 'yourewelcome' // Changed from 'Amazing' for clarity\r\n    },\r\n    name: {\r\n      japanese: 'ãªã¾ãˆ',\r\n      english: 'name' // Changed from 'Amazing' for clarity\r\n    }\r\n  }), []);\r\n\r\n\r\n  /**\r\n   * ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©\r\n   */\r\n  const handleLogout = () => {\r\n    setIsLoggedIn(false); // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’falseã«è¨­å®š\r\n  };\r\n\r\n  // SkyWay App ID ã¨ Secret Key\r\n  // æ³¨æ„: æœ¬ç•ªç’°å¢ƒã§ã¯ã€ã“ã‚Œã‚‰ã®ã‚­ãƒ¼ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã›ãšã€\r\n  // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å®‰å…¨ã«æ¸¡ã™ã“ã¨ã‚’å¼·ãæŽ¨å¥¨ã—ã¾ã™ã€‚\r\n  const appId = useMemo(() => \"4490dcb5-dbe8-4028-ba0a-6d0d143e4515\", []);\r\n  const secretKey = useMemo(() => \"40HHGEIOx0BRByPdxqwUswK0a+7v2JaeaJ9CcFjMdAQ=\", []);\r\n\r\n  // SkyWayèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆ\r\n  const token = useMemo(() => {\r\n    if (appId == null || secretKey == null) return undefined;\r\n\r\n    return new SkyWayAuthToken({\r\n      jti: uuidV4(), // JWT ID\r\n      iat: nowInSec(), // ç™ºè¡Œæ™‚åˆ»\r\n      exp: nowInSec() + 60 * 60 * 24, // æœ‰åŠ¹æœŸé™ (24æ™‚é–“)\r\n      version: 3,\r\n      scope: {\r\n        appId: appId,\r\n        rooms: [\r\n          {\r\n            name: \"*\", // ã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒ åã«é©ç”¨\r\n            methods: [\"create\", \"close\", \"updateMetadata\"], // ãƒ«ãƒ¼ãƒ æ“ä½œã®æ¨©é™\r\n            member: {\r\n              name: \"*\", // ã™ã¹ã¦ã®ãƒ¡ãƒ³ãƒãƒ¼ã«é©ç”¨\r\n              methods: [\"publish\", \"subscribe\", \"updateMetadata\"] // ãƒ¡ãƒ³ãƒãƒ¼æ“ä½œã®æ¨©é™\r\n            }\r\n          }],\r\n        turn: {\r\n          enabled: true // TURNã‚µãƒ¼ãƒãƒ¼ã®ä½¿ç”¨ã‚’è¨±å¯ (NATè¶Šãˆã®ãŸã‚)\r\n        }\r\n      }\r\n    }).encode(secretKey);\r\n\r\n  }, [appId, secretKey]);\r\n\r\n  /**\r\n   * SkyWayContextã®åˆæœŸåŒ–ã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’è¡Œã†useEffect\r\n   * ãƒˆãƒ¼ã‚¯ãƒ³ãŒåˆ©ç”¨å¯èƒ½ã«ãªã£ãŸã¨ãã«ä¸€åº¦ã ã‘å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚\r\n   */\r\n  useEffect(() => {\r\n    if (!token) return;\r\n\r\n    let currentContext;\r\n    const initContext = async () => {\r\n      try {\r\n        currentContext = await SkyWayContext.Create(token);\r\n        setSkywayContext(currentContext);\r\n        console.log(\"SkyWayContext created successfully.\");\r\n      } catch (error) {\r\n        console.error(\"Failed to create SkyWayContext:\", error);\r\n      }\r\n    };\r\n\r\n    initContext();\r\n\r\n    // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¢ãƒ³ãƒžã‚¦ãƒ³ãƒˆæ™‚ã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç ´æ£„\r\n    return () => {\r\n      if (currentContext) {\r\n        currentContext.dispose();\r\n        console.log(\"SkyWayContext disposed.\");\r\n      }\r\n    };\r\n  }, [token]); // tokenãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã«ã®ã¿å®Ÿè¡Œ\r\n\r\n  // ðŸŒŸè¿½åŠ : SpeechRecognition APIã®åˆæœŸåŒ–\r\n  useEffect(() => {\r\n    // ãƒ–ãƒ©ã‚¦ã‚¶ãŒSpeechRecognitionã«å¯¾å¿œã—ã¦ã„ã‚‹ã‹ç¢ºèª\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    if (!SpeechRecognition) {\r\n      console.error(\"SpeechRecognition API is not supported by this browser.\");\r\n      return;\r\n    }\r\n\r\n    // SpeechRecognitionã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–\r\n    recognition.current = new SpeechRecognition();\r\n    recognition.current.continuous = true; // é€£ç¶šçš„ãªèªè­˜\r\n    recognition.current.interimResults = true; // ä¸­é–“çµæžœã‚’è¿”ã™\r\n    recognition.current.lang = 'ja-JP'; // æ—¥æœ¬èªžã‚’æŒ‡å®š\r\n\r\n    // éŸ³å£°èªè­˜ã®çµæžœã‚’å‡¦ç†ã™ã‚‹ãƒãƒ³ãƒ‰ãƒ©\r\n    recognition.current.onresult = (event) => {\r\n      let finalTranscript = '';\r\n      for (let i = event.resultIndex; i < event.results.length; ++i) {\r\n        if (event.results[i].isFinal) {\r\n          finalTranscript = event.results[i][0].transcript;\r\n          break; // æœ€åˆã®ç¢ºå®šã—ãŸçµæžœã®ã¿ã‚’å–å¾—\r\n        }\r\n      }\r\n\r\n      // ç¢ºå®šã—ãŸçµæžœãŒç©ºã§ãªã‘ã‚Œã°Skywayã§é€ä¿¡\r\n      if (finalTranscript.trim() !== '') {\r\n        console.log(\"Transcription final result:\", finalTranscript);\r\n        // Skywayã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ã§é€ä¿¡\r\n        if (localDataStreamRef.current && me) {\r\n          //const result = `translate_data_web:${finalTranscript}`; \r\n          const URL2 = URL + apiKey + \"&q=\"+encodeURI(finalTranscript)+\"&source=\"+'ja'+\"&target=\"+'en';  // eslint-disable-line\r\n          let xhr = new XMLHttpRequest()\r\n          xhr.open('POST', [URL2], false)\r\n          xhr.send();\r\n          if (xhr.status === 200) {\r\n            const res = JSON.parse(xhr.responseText); \r\n            const res2 = res[\"data\"][\"translations\"][0][\"translatedText\"]\r\n            const res3 =`translate_data_web:${res2}`;\r\n            localDataStreamRef.current.write(res3);\r\n          }\r\n\r\n          console.log(`Sent transcription: \"${finalTranscript}\"`);\r\n          // è‡ªåˆ†ã®ç”»é¢ã«ã‚‚è¡¨ç¤º\r\n          setReceivedMessages(prevMessages => [...prevMessages, { senderId: me.id, message: finalTranscript, isLocal: true }]);\r\n        }\r\n      }\r\n    };\r\n\r\n    // èªè­˜ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©\r\n    recognition.current.onerror = (event) => {\r\n      console.error(\"Speech recognition error:\", event.error);\r\n      setIsListening(false); // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒªã‚¹ãƒ‹ãƒ³ã‚°çŠ¶æ…‹ã‚’åœæ­¢\r\n    };\r\n\r\n    // èªè­˜çµ‚äº†æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©\r\n    recognition.current.onend = () => {\r\n      console.log(\"Speech recognition ended.\");\r\n      // é€£ç¶šèªè­˜ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã€è‡ªå‹•çš„ã«å†èµ·å‹•ã•ã‚Œã‚‹ãŸã‚ã€ç‰¹åˆ¥ãªå‡¦ç†ã¯ä¸è¦\r\n      // if (isListening) {\r\n      //   recognition.current.start();\r\n      // }\r\n    };\r\n\r\n    // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¢ãƒ³ãƒžã‚¦ãƒ³ãƒˆæ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\r\n    return () => {\r\n      if (recognition.current) {\r\n        recognition.current.stop();\r\n      }\r\n    };\r\n  }, [me, localDataStreamRef]);\r\n\r\n  /**\r\n   * ãƒªãƒ¢ãƒ¼ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’DOMã«è¿½åŠ ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°\r\n   * @param {RemoteVideoStream | RemoteAudioStream} stream - è¿½åŠ ã™ã‚‹ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¹ãƒˆãƒªãƒ¼ãƒ \r\n   * @param {string} memberId - ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã®ãƒ¡ãƒ³ãƒãƒ¼ID\r\n   */\r\n  const attachRemoteStream = (stream, memberId) => {\r\n    if (robotDisplayRef.current && (stream instanceof RemoteVideoStream || stream instanceof RemoteAudioStream)) {\r\n      // æ—¢å­˜ã®ãƒ“ãƒ‡ã‚ªè¦ç´ ãŒã‚ã‚Œã°å‰Šé™¤\r\n      const existingVideo = remoteVideoElements.current.get(memberId);\r\n      if (existingVideo) {\r\n        robotDisplayRef.current.removeChild(existingVideo);\r\n        remoteVideoElements.current.delete(memberId);\r\n      }\r\n\r\n      const video = document.createElement(\"video\");\r\n      video.autoplay = true; // è‡ªå‹•å†ç”Ÿ\r\n      video.playsInline = true; // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³å†ç”Ÿ (iOSãªã©ã§å¿…è¦)\r\n      video.className = \"remote-video object-cover\"; // ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ç”¨ã®ã‚¯ãƒ©ã‚¹ã¨object-coverã‚’è¿½åŠ \r\n      video.dataset.memberId = memberId; // ãƒ¡ãƒ³ãƒãƒ¼IDã‚’ãƒ‡ãƒ¼ã‚¿å±žæ€§ã«ä¿å­˜\r\n      stream.attach(video); // ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ãƒ“ãƒ‡ã‚ªè¦ç´ ã®ã‚½ãƒ¼ã‚¹ã«è¨­å®š\r\n      robotDisplayRef.current.appendChild(video);\r\n      remoteVideoElements.current.set(memberId, video);\r\n      console.log(`Attached stream from ${memberId} to DOM.`);\r\n    } else {\r\n      console.warn(`Attempted to attach non-media stream or robotDisplayRef is null for member ${memberId}.`);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®å—ä¿¡ã‚’å‡¦ç†ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°\r\n   * @param {RemoteDataStream} stream - å—ä¿¡ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ \r\n   * @param {string} memberId - ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã®ãƒ¡ãƒ³ãƒãƒ¼ID\r\n   */\r\n  const handleDataStream = (stream, memberId) => {\r\n    if (stream instanceof RemoteDataStream) {\r\n      stream.onData.add((data) => {\r\n        console.log(`Received data from ${memberId}:`, data);\r\n        // å—ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’çŠ¶æ…‹ã«è¿½åŠ \r\n        setReceivedMessages(prevMessages => [...prevMessages, { senderId: memberId, message: data }]);\r\n\r\n        // \"move_finish\" ã‚·ã‚°ãƒŠãƒ«ã‚’ãƒã‚§ãƒƒã‚¯\r\n        if (data === \"move_finish\") {\r\n          console.log(\"Received 'move_finish' signal. Enabling side panel buttons.\");\r\n          setIsMoveInProgress(false); // ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†\r\n        }\r\n\r\n        // AIææ¡ˆã®ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã‚’ãƒã‚§ãƒƒã‚¯\r\n        // æ–°ã—ã„ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ \"ai_assist_1:data:ai_assist_2:data\" ã‚’è§£æž\r\n        const aiCombinedSuggestionRegex = /^ai_assist_1:(.*):ai_assist_2:(.*)$/;\r\n        const combinedMatch = String(data).match(aiCombinedSuggestionRegex);\r\n\r\n        if (combinedMatch) {\r\n          const suggestion1Content = combinedMatch[1]; // ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚°ãƒ«ãƒ¼ãƒ—1ãŒæœ€åˆã®ææ¡ˆ\r\n          const suggestion2Content = combinedMatch[2]; // ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚°ãƒ«ãƒ¼ãƒ—2ãŒ2ç•ªç›®ã®ææ¡ˆ\r\n          console.log(suggestion1Content);\r\n          console.log(suggestion2Content);\r\n\r\n          setAiSuggestions([\r\n            { key: 'ai_assist_1', text: suggestion1Content }, // ã‚­ãƒ¼ã‚’ai_assist_1ã«ä¿®æ­£\r\n            { key: 'ai_assist_2', text: suggestion2Content }  // ã‚­ãƒ¼ã‚’ai_assist_2ã«ä¿®æ­£\r\n          ]);\r\n          console.log(\"Received combined AI suggestions.\");\r\n        } else {\r\n          // ä»¥å‰ã®å˜ä¸€ææ¡ˆãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã‚‚è€ƒæ…®ã™ã‚‹å ´åˆï¼ˆã‚‚ã—ä¸¡æ–¹ã®ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆãŒæ··åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãªã‚‰ï¼‰\r\n          const aiSingleSuggestionRegex = /^ai_assist_(\\d+):(.*)$/;\r\n          const singleMatch = String(data).match(aiSingleSuggestionRegex);\r\n\r\n          if (singleMatch) {\r\n            const suggestionNumber = parseInt(singleMatch[1], 10);\r\n            const suggestionContent = singleMatch[2];\r\n\r\n            if (suggestionNumber === 1 || suggestionNumber === 2) {\r\n              setAiSuggestions(prevSuggestions => {\r\n                const newSuggestions = [...prevSuggestions];\r\n                newSuggestions[suggestionNumber - 1] = {\r\n                  key: `ai_assist_${suggestionNumber}`, // ã‚­ãƒ¼ã‚’ai_assist_Nã«ä¿®æ­£\r\n                  text: suggestionContent\r\n                };\r\n                return newSuggestions;\r\n              });\r\n              console.log(`Received single AI suggestion ${suggestionNumber}.`);\r\n            }\r\n          }\r\n        }\r\n\r\n        // æ–°ã—ã„ç¿»è¨³ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã‚’ãƒã‚§ãƒƒã‚¯\r\n        const translateRegex = /^translate_request:(.*)$/;\r\n        const translateMatch = String(data).match(translateRegex);\r\n\r\n        if (translateMatch) {\r\n          const translatedContent = translateMatch[1];\r\n          setTranslatedText(translatedContent); // çŠ¶æ…‹ã‚’æ›´æ–°\r\n          console.log(`Received translated text: ${translatedContent}`);\r\n        } else {\r\n          // ç¿»è¨³ãƒ‡ãƒ¼ã‚¿ã§ã¯ãªã„å ´åˆã€ç¿»è¨³ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ã‹ã¯è¦æ¤œè¨Ž\r\n          // setTranslatedText(\"\");\r\n        }\r\n      });\r\n      console.log(`Listening for data from ${memberId}.`);\r\n    } else {\r\n      console.warn(`Attempted to handle non-data stream as data stream for member ${memberId}.`);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * ãƒ«ãƒ¼ãƒ ã«å‚åŠ ã™ã‚‹ãƒãƒ³ãƒ‰ãƒ©\r\n   * SkyWayContextãŒåˆæœŸåŒ–ã•ã‚Œã€ãƒ«ãƒ¼ãƒ åãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚\r\n   */\r\n  const handleJoinRoom = async () => {\r\n    if (!skywayContext) {\r\n      console.error(\"SkyWayContext is not initialized. Please wait or check token.\");\r\n      return;\r\n    }\r\n    if (!roomName) {\r\n      console.error(\"Room name is empty. Please enter a room name to join.\");\r\n      return;\r\n    }\r\n    if (skywayRoom && me) {\r\n      console.warn(\"Already in a room. Please leave the current room first.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // æŒ‡å®šã•ã‚ŒãŸãƒ«ãƒ¼ãƒ åã§P2Pãƒ«ãƒ¼ãƒ ã‚’ä½œæˆã¾ãŸã¯æ¤œç´¢\r\n      const room = await SkyWayRoom.FindOrCreate(skywayContext, {\r\n        type: \"p2p\", // P2Pãƒ«ãƒ¼ãƒ ã‚¿ã‚¤ãƒ—\r\n        name: roomName,\r\n      });\r\n\r\n      // roomã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª\r\n      if (!room) {\r\n        console.error(\"SkyWayRoom.FindOrCreate returned null or undefined room.\");\r\n        throw new Error(\"Failed to create or find SkyWayRoom.\");\r\n      }\r\n\r\n      setSkywayRoom(room);\r\n      console.log(`SkyWayRoom '${roomName}' found or created.`);\r\n\r\n      // ãƒ«ãƒ¼ãƒ ã«å‚åŠ ã—ã€è‡ªåˆ†ã®ãƒ¡ãƒ³ãƒãƒ¼æƒ…å ±ã‚’å–å¾—\r\n      const localMember = await room.join();\r\n      // localMemberãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª\r\n      if (!localMember) {\r\n        console.error(\"room.join() returned null or undefined localMember.\");\r\n        throw new Error(\"Failed to join the room.\");\r\n      }\r\n      setMe(localMember);\r\n      console.log(`Joined room '${roomName}' as member ID: ${localMember.id}`);\r\n      // ãƒ«ãƒ¼ãƒ IDã¨è‡ªåˆ†ã®IDã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤º\r\n      console.log(`Room ID: ${roomName} / My ID: ${localMember.id}`);\r\n\r\n\r\n      // è‡ªåˆ†ã®ã‚«ãƒ¡ãƒ©ã¨ãƒžã‚¤ã‚¯ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ä½œæˆã—ã€å…¬é–‹\r\n      const { audio, video } = await SkyWayStreamFactory.createMicrophoneAudioAndCameraStream();\r\n      localStreamRef.current = video; // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ“ãƒ‡ã‚ªã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ä¿å­˜\r\n      await localMember.publish(video);\r\n      const publication_audio = await localMember.publish(audio);\r\n      audioPublicationRef.current = publication_audio; // ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªPublicationã‚’ä¿å­˜\r\n      setIsMuted(false);\r\n      console.log(\"Published local camera and microphone stream.\");\r\n\r\n      // è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ä½œæˆã—ã€å…¬é–‹\r\n      const dataStream = await SkyWayStreamFactory.createDataStream();\r\n      localDataStreamRef.current = dataStream; // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ä¿å­˜\r\n      await localMember.publish(dataStream);\r\n      console.log(\"Published local data stream.\");\r\n\r\n      // ãƒ«ãƒ¼ãƒ å‚åŠ æ™‚ã¯ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹ã«ã™ã‚‹ï¼ˆãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã¾ã å§‹ã¾ã£ã¦ã„ãªã„ãŸã‚ï¼‰\r\n      setIsMoveInProgress(false);\r\n\r\n\r\n      // --- æ—¢å­˜ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’è³¼èª­ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ ---\r\n      // ãƒ«ãƒ¼ãƒ å†…ã®æ—¢å­˜ã®å…¬é–‹ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ã™ã¹ã¦è³¼èª­ã™ã‚‹\r\n      for (const publication of room.publications) {\r\n        // è‡ªåˆ†ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¯è³¼èª­ã—ãªã„\r\n        if (localMember.id === publication.publisher.id) {\r\n          continue;\r\n        }\r\n        try {\r\n          const { stream } = await localMember.subscribe(publication.id);\r\n          console.log(`Subscribed to existing stream from ${publication.publisher.id}, type: ${publication.contentType}`);\r\n\r\n          if (publication.contentType === 'video' || publication.contentType === 'audio') {\r\n            attachRemoteStream(stream, publication.publisher.id);\r\n          } else if (publication.contentType === 'data') {\r\n            handleDataStream(stream, publication.publisher.id);\r\n          } else {\r\n            console.warn(`Unknown stream content type: ${publication.contentType} from ${publication.publisher.id}`);\r\n          }\r\n        } catch (subscribeError) {\r\n          console.error(`Failed to subscribe to existing stream from ${publication.publisher.id}:`, subscribeError);\r\n        }\r\n      }\r\n\r\n      // --- ãƒ«ãƒ¼ãƒ ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š ---\r\n\r\n      // ãƒ¡ãƒ³ãƒãƒ¼ãŒãƒ«ãƒ¼ãƒ ã«å‚åŠ ã—ãŸã¨ãã®ã‚¤ãƒ™ãƒ³ãƒˆ\r\n      if (room.onMemberJoined) {\r\n        room.onMemberJoined.add((e) => {\r\n          console.log(`Member joined: ${e.member.id}`);\r\n        });\r\n      } else {\r\n        console.error(\"room.onMemberJoined is undefined. This is unexpected.\");\r\n      }\r\n\r\n      // ãƒ¡ãƒ³ãƒãƒ¼ãŒãƒ«ãƒ¼ãƒ ã‚’é›¢è„±ã—ãŸã¨ãã®ã‚¤ãƒ™ãƒ³ãƒˆ\r\n      if (room.onMemberLeft) {\r\n        room.onMemberLeft.add((e) => {\r\n          console.log(`Member left: ${e.member.id}`);\r\n          // è©²å½“ãƒ¡ãƒ³ãƒãƒ¼ã®ãƒ“ãƒ‡ã‚ªè¦ç´ ã‚’DOMã‹ã‚‰å‰Šé™¤ã—ã€Mapã‹ã‚‰ã‚‚å‰Šé™¤\r\n          const videoElement = remoteVideoElements.current.get(e.member.id);\r\n          if (videoElement && robotDisplayRef.current) {\r\n            robotDisplayRef.current.removeChild(videoElement);\r\n            remoteVideoElements.current.delete(e.member.id);\r\n            console.log(`Removed video for member ${e.member.id}`);\r\n          }\r\n          // ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ é–¢é€£ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚‚ã“ã“ã«è¿½åŠ å¯èƒ½ã§ã™ãŒã€\r\n          // onDataãƒªã‚¹ãƒŠãƒ¼ã¯ã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒé–‰ã˜ã‚‰ã‚Œã‚‹ã¨è‡ªå‹•çš„ã«åœæ­¢ã—ã¾ã™ã€‚\r\n        });\r\n      } else {\r\n        console.error(\"room.onMemberLeft is undefined. This is unexpected.\");\r\n      }\r\n\r\n      // ã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒå…¬é–‹ã•ã‚ŒãŸã¨ãã®ã‚¤ãƒ™ãƒ³ãƒˆ\r\n      if (room.onStreamPublished) {\r\n        room.onStreamPublished.add(async (e) => {\r\n          console.log(`Stream published by ${e.publication.publisher.id}, type: ${e.publication.contentType}`);\r\n          // è‡ªåˆ†ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¯è³¼èª­ã—ãªã„\r\n          if (localMember.id !== e.publication.publisher.id) {\r\n            try {\r\n              // ãƒªãƒ¢ãƒ¼ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’è³¼èª­\r\n              const { stream } = await localMember.subscribe(e.publication.id);\r\n              console.log(`Subscribed to stream from ${e.publication.publisher.id}`);\r\n\r\n              if (e.publication.contentType === 'video' || e.publication.contentType === 'audio') {\r\n                attachRemoteStream(stream, e.publication.publisher.id);\r\n              } else if (e.publication.contentType === 'data') {\r\n                handleDataStream(stream, e.publication.publisher.id);\r\n              } else {\r\n                console.warn(`Unknown stream content type: ${e.publication.contentType} from ${e.publication.publisher.id}`);\r\n              }\r\n            } catch (subscribeError) {\r\n              console.error(`Failed to subscribe to stream from ${e.publication.publisher.id}:`, subscribeError);\r\n            }\r\n          } else {\r\n            console.log(`Skipping subscription for own stream: ${e.publication.publisher.id}`);\r\n          }\r\n        });\r\n      } else {\r\n        console.error(\"room.onStreamPublished is undefined. This is unexpected.\");\r\n      }\r\n\r\n      // ã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒéžå…¬é–‹ã«ãªã£ãŸã¨ãã®ã‚¤ãƒ™ãƒ³ãƒˆ\r\n      if (room.onStreamUnpublished) {\r\n        room.onStreamUnpublished.add((e) => {\r\n          console.log(`Stream unpublished by ${e.publication.publisher.id}`);\r\n          // è©²å½“ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ãƒ“ãƒ‡ã‚ªè¦ç´ ã‚’DOMã‹ã‚‰å‰Šé™¤ã—ã€Mapã‹ã‚‰ã‚‚å‰Šé™¤\r\n          const videoElement = remoteVideoElements.current.get(e.publication.publisher.id);\r\n          if (videoElement && robotDisplayRef.current) {\r\n            robotDisplayRef.current.removeChild(videoElement);\r\n            remoteVideoElements.current.delete(e.publication.publisher.id);\r\n            console.log(`Removed unpublished video for member ${e.publication.publisher.id}`);\r\n          }\r\n        });\r\n      } else {\r\n        console.error(\"room.onStreamUnpublished is undefined. This is unexpected.\");\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error(\"Failed to join room:\", error);\r\n      // ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã«çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦å†è©¦è¡Œå¯èƒ½ã«ã™ã‚‹\r\n      setSkywayRoom(null);\r\n      setMe(null);\r\n      // ã‚¨ãƒ©ãƒ¼æ™‚ã«æ—¢å­˜ã®ãƒ“ãƒ‡ã‚ªè¦ç´ ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\r\n      if (robotDisplayRef.current) {\r\n        Array.from(robotDisplayRef.current.children).forEach(child => {\r\n          if (child.tagName === 'VIDEO') {\r\n            // ãƒ“ãƒ‡ã‚ªè¦ç´ ã®srcObjectã‚’ã‚¯ãƒªã‚¢ã—ã€ãƒˆãƒ©ãƒƒã‚¯ã‚’åœæ­¢\r\n            if (child.srcObject && typeof child.srcObject.getTracks === 'function') {\r\n              child.srcObject.getTracks().forEach(track => track.stop());\r\n              child.srcObject = null;\r\n            }\r\n            child.remove(); // DOMã‹ã‚‰è¦ç´ ã‚’å‰Šé™¤\r\n          }\r\n        });\r\n      }\r\n      remoteVideoElements.current.clear();\r\n      if (localStreamRef.current) {\r\n        // LocalVideoStreamã®stop()ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™\r\n        if (typeof localStreamRef.current.stop === 'function') {\r\n          localStreamRef.current.stop();\r\n          console.log(\"Stopped local media stream during join error cleanup.\");\r\n        } else {\r\n          console.warn(\"localStreamRef.current is not a valid LocalVideoStream or stop is not a function during join error cleanup.\");\r\n        }\r\n        localStreamRef.current = null;\r\n      }\r\n      // LocalDataStreamã¯è‡ªå‹•çš„ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã•ã‚Œã‚‹ãŸã‚ã€æ˜Žç¤ºçš„ãªclose()ã¯ä¸è¦\r\n      localDataStreamRef.current = null; // å‚ç…§ã‚’ã‚¯ãƒªã‚¢\r\n      console.log(\"Local data stream reference cleared during join error cleanup.\");\r\n\r\n      // ãƒŸãƒ¥ãƒ¼ãƒˆçŠ¶æ…‹ã‚‚ãƒªã‚»ãƒƒãƒˆ\r\n      setIsMuted(false);\r\n      audioPublicationRef.current = null;\r\n      setIsMoveInProgress(false); // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\r\n      setTranslatedText(\"\"); // ç¿»è¨³ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢\r\n    }\r\n  };\r\n\r\n  /**\r\n   * ãƒ«ãƒ¼ãƒ ã‹ã‚‰é€€å‡ºã™ã‚‹ãƒãƒ³ãƒ‰ãƒ©\r\n   */\r\n  const handleLeaveRoom = async () => {\r\n    if (skywayRoom && me) {\r\n      try {\r\n        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’åœæ­¢ã—ã€å…¬é–‹ã‚’è§£é™¤\r\n        if (localStreamRef.current) {\r\n          // LocalVideoStreamã®stop()ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™\r\n          if (typeof localStreamRef.current.stop === 'function') {\r\n            localStreamRef.current.stop();\r\n            console.log(\"Stopped local media stream.\");\r\n          } else {\r\n            console.warn(\"localStreamRef.current is not a valid LocalVideoStream or stop is not a function during leave.\");\r\n          }\r\n          localStreamRef.current = null;\r\n        }\r\n        // LocalDataStreamã¯è‡ªå‹•çš„ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã•ã‚Œã‚‹ãŸã‚ã€æ˜Žç¤ºçš„ãªclose()ã¯ä¸è¦\r\n        localDataStreamRef.current = null; // å‚ç…§ã‚’ã‚¯ãƒªã‚¢\r\n        console.log(\"Local data stream reference cleared.\");\r\n\r\n        // ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªPublicationã®å‚ç…§ã‚’ã‚¯ãƒªã‚¢\r\n        audioPublicationRef.current = null;\r\n        setIsMuted(false); // ãƒŸãƒ¥ãƒ¼ãƒˆçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\r\n        setTranslatedText(\"\"); // ç¿»è¨³ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢\r\n        // ï¿½è¿½åŠ : ãƒ«ãƒ¼ãƒ é€€å‡ºæ™‚ã«éŸ³å£°èªè­˜ã‚’åœæ­¢\r\n        if (isListening) {\r\n          recognition.current.stop();\r\n          setIsListening(false);\r\n        }\r\n\r\n        await me.leave(); // ãƒ«ãƒ¼ãƒ ã‹ã‚‰é€€å‡º\r\n        console.log(`Left room '${roomName}'`);\r\n        // ãƒ«ãƒ¼ãƒ é€€å‡ºã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤º\r\n        console.log(`Left room: ${roomName}`);\r\n\r\n\r\n        // room.dispose()ã‚’ä½¿ç”¨\r\n        if (skywayRoom) {\r\n          await skywayRoom.dispose(); // ãƒ«ãƒ¼ãƒ ã‚’é–‰ã˜ã‚‹ (ã“ã‚Œã¯ãƒ«ãƒ¼ãƒ ã®ä½œæˆè€…ã®ã¿ãŒåŠ¹æžœçš„ã§ã™)\r\n          console.log(\"SkyWay Room disposed.\");\r\n        }\r\n        // SkyWay SDKã«é–¢ã™ã‚‹ã™ã¹ã¦ã®æ“ä½œãŒä¸è¦ã«ãªã£ãŸå ´åˆã«context.dispose()ã‚’å‘¼ã³å‡ºã™\r\n        // ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¢ãƒ³ãƒžã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹éš›ã«useEffectã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã§å‡¦ç†ã•ã‚Œã‚‹ãŸã‚ã€ã“ã“ã§ã¯å‘¼ã³å‡ºã•ãªã„\r\n\r\n      } catch (error) {\r\n      } finally {\r\n        // çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\r\n        setMe(null);\r\n        setSkywayRoom(null);\r\n        setReceivedMessages([]); // å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚ã‚¯ãƒªã‚¢\r\n        // ã™ã¹ã¦ã®ãƒªãƒ¢ãƒ¼ãƒˆãƒ“ãƒ‡ã‚ªè¦ç´ ã‚’DOMã‹ã‚‰å‰Šé™¤\r\n        if (robotDisplayRef.current) {\r\n          Array.from(robotDisplayRef.current.children).forEach(child => {\r\n            if (child.tagName === 'VIDEO') {\r\n              // ãƒ“ãƒ‡ã‚ªè¦ç´ ã®srcObjectã‚’ã‚¯ãƒªã‚¢ã—ã€ãƒˆãƒ©ãƒƒã‚¯ã‚’åœæ­¢\r\n              if (child.srcObject && typeof child.srcObject.getTracks === 'function') {\r\n                child.srcObject.getTracks().forEach(track => track.stop());\r\n                child.srcObject = null;\r\n              }\r\n              child.remove(); // DOMã‹ã‚‰è¦ç´ ã‚’å‰Šé™¤\r\n            }\r\n          });\r\n        }\r\n        remoteVideoElements.current.clear();\r\n        // AIãƒ¢ãƒ¼ãƒ‰ã‚‚ã‚ªãƒ•ã«ã™ã‚‹\r\n        setIsAiModeOn(false);\r\n        setAiSuggestions([null, null]); // ææ¡ˆã‚‚ã‚¯ãƒªã‚¢\r\n        setIsMoveInProgress(false); // ãƒ«ãƒ¼ãƒ é€€å‡ºæ™‚ã‚‚ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ“ä½œã™ã‚‹ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã®å‡¦ç†\r\n   * @param {string | object} messageOrKey - é€ä¿¡ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚­ãƒ¼ (messagesã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚­ãƒ¼) ã¾ãŸã¯AIææ¡ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ\r\n   */\r\n  const handleSend = async (messageOrKey) => {\r\n    if (me && skywayRoom && localDataStreamRef.current) {\r\n      try {\r\n        let messageToSend;\r\n        let shouldSetMoveInProgress = false; // ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³é€²è¡Œä¸­ãƒ•ãƒ©ã‚°ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®æ–°ã—ã„å¤‰æ•°\r\n\r\n        if (typeof messageOrKey === 'string') {\r\n          // ã‚µã‚¤ãƒ‰ãƒœã‚¿ãƒ³ã‹ã‚‰ã®é€ä¿¡ã®å ´åˆã€ç›´æŽ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ–‡å­—åˆ—ã‚’ä½¿ç”¨\r\n          if (messageOrKey.startsWith(\"template_motion_\")) {\r\n            messageToSend = messageOrKey;\r\n            shouldSetMoveInProgress = true; // ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒžãƒ³ãƒ‰ã®å ´åˆã®ã¿ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹\r\n          } else if (messageOrKey.startsWith(\"template_voice_\")) {\r\n            messageToSend = messageOrKey;\r\n            // ãƒœã‚¤ã‚¹ã‚³ãƒžãƒ³ãƒ‰ã®å ´åˆã¯shouldSetMoveInProgressã‚’trueã«ã—ãªã„\r\n          } else if (messageOrKey.startsWith(\"robot_reset\")){\r\n            messageToSend = messageOrKey;\r\n          } else {\r\n            // æ—¢å­˜ã®messagesã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã®ãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ— (AIææ¡ˆä»¥å¤–ã§ã‚­ãƒ¼ãŒæ¸¡ã•ã‚ŒãŸå ´åˆãªã©)\r\n            messageToSend = messages[messageOrKey];\r\n          }\r\n        } else if (typeof messageOrKey === 'object' && messageOrKey.key) { // messageOrKey.text ã‹ã‚‰ messageOrKey.key ã«å¤‰æ›´\r\n          // AIææ¡ˆãƒœã‚¿ãƒ³ã‹ã‚‰ã®é€ä¿¡\r\n          messageToSend = messageOrKey.key; // ææ¡ˆã®ã‚­ãƒ¼ï¼ˆai_assist_1ãªã©ï¼‰ã‚’é€ä¿¡\r\n          // AIææ¡ˆã®å ´åˆã¯shouldSetMoveInProgressã‚’trueã«ã—ãªã„\r\n        }\r\n\r\n        if (!messageToSend) {\r\n          console.warn(`Message to send is empty or not found.`);\r\n          return;\r\n        }\r\n\r\n        localDataStreamRef.current.write(messageToSend);\r\n        console.log(`Sent message: \"${messageToSend}\"`);\r\n        // é€ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚è‡ªèº«ã®ç”»é¢ã«è¡¨ç¤º\r\n        setReceivedMessages(prevMessages => [...prevMessages, { senderId: me.id, message: messageToSend, isLocal: true }]);\r\n        setAiSuggestions([null, null]); // é€ä¿¡ã—ãŸã‚‰ææ¡ˆã‚’ã‚¯ãƒªã‚¢\r\n\r\n        // shouldSetMoveInProgressãŒtrueã®å ´åˆã®ã¿ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³é€²è¡Œä¸­çŠ¶æ…‹ã«ã™ã‚‹\r\n        if (shouldSetMoveInProgress) {\r\n          setIsMoveInProgress(true);\r\n        }\r\n        // AIææ¡ˆã‚„ãƒœã‚¤ã‚¹ã‚³ãƒžãƒ³ãƒ‰ã®å ´åˆã¯ã€isMoveInProgressã¯å¤‰æ›´ã—ãªã„\r\n        // (ä»¥å‰ã®ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ãŒé€²è¡Œä¸­ã§ã‚ã‚Œã°ãã®ã¾ã¾ã€ãã†ã§ãªã‘ã‚Œã°falseã®ã¾ã¾)\r\n\r\n      } catch (error) {\r\n        console.error(\"Failed to send data:\", error);\r\n      }\r\n    } else {\r\n      console.warn(\"Cannot send message: Not in a room, 'me' object is not available, or data stream is not ready.\");\r\n    }\r\n  };\r\n\r\n  /**\r\n   * ãƒžã‚¤ã‚¯ã®ãƒŸãƒ¥ãƒ¼ãƒˆ/ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãƒãƒ³ãƒ‰ãƒ©\r\n   */\r\n  const handleMute = async () => {\r\n    console.log(\"start\");\r\n    if (!audioPublicationRef.current) {\r\n      console.warn(\"Audio publication not available. Cannot toggle mute.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      if (isMuted) {\r\n        // ç¾åœ¨ãƒŸãƒ¥ãƒ¼ãƒˆçŠ¶æ…‹ãªã‚‰ã€ãƒŸãƒ¥ãƒ¼ãƒˆã‚’è§£é™¤\r\n        await audioPublicationRef.current.enable();\r\n        console.log(\"Microphone unmuted.\");\r\n      } else {\r\n        // ç¾åœ¨ãƒŸãƒ¥ãƒ¼ãƒˆçŠ¶æ…‹ã§ãªã„ãªã‚‰ã€ãƒŸãƒ¥ãƒ¼ãƒˆ\r\n        await audioPublicationRef.current.disable();\r\n        console.log(\"Microphone muted.\");\r\n      }\r\n      setIsMuted(!isMuted); // ãƒŸãƒ¥ãƒ¼ãƒˆçŠ¶æ…‹ã‚’ãƒˆã‚°ãƒ«\r\n    } catch (error) {\r\n      console.error(\"Failed to toggle microphone mute state:\", error);\r\n    }\r\n  };\r\n\r\n  // AIãƒ¢ãƒ¼ãƒ‰ãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã«ã‚·ã‚°ãƒŠãƒ«ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã®ãƒ•ãƒ©ã‚°\r\n  const isInitialAiModeRender = useRef(true);\r\n\r\n  /**\r\n   * AIãƒ¢ãƒ¼ãƒ‰ã®çŠ¶æ…‹å¤‰æ›´ã‚’ç›£è¦–ã—ã€ã‚·ã‚°ãƒŠãƒ«ã‚’é€ä¿¡ã™ã‚‹useEffect\r\n   */\r\n  useEffect(() => {\r\n    // åˆå›žãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã¯ã‚·ã‚°ãƒŠãƒ«ã‚’é€ä¿¡ã—ãªã„\r\n    if (isInitialAiModeRender.current) {\r\n      isInitialAiModeRender.current = false;\r\n      return;\r\n    }\r\n\r\n    // me ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒåˆ©ç”¨å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª\r\n    if (!me || !localDataStreamRef.current) {\r\n      return;\r\n    }\r\n\r\n    if (isAiModeOn) {\r\n      // AIãƒ¢ãƒ¼ãƒ‰ãŒONã«ãªã£ãŸã‚‰ã€AIã«ææ¡ˆã‚’è¦æ±‚ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡\r\n      localDataStreamRef.current.write(\"robot_reset\");\r\n      console.log(\"Sent AI_MODE_REQUEST_SUGGESTIONS signal.\");\r\n      setAiSuggestions([null, null]); // æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ãŸã‚ã«ææ¡ˆã‚’ã‚¯ãƒªã‚¢\r\n    } else {\r\n      // AIãƒ¢ãƒ¼ãƒ‰ãŒOFFã«ãªã£ãŸã‚‰ææ¡ˆã‚’ã‚¯ãƒªã‚¢ã—ã€AIãƒ¢ãƒ¼ãƒ‰çµ‚äº†ã®ã‚·ã‚°ãƒŠãƒ«ã‚’é€ä¿¡\r\n      localDataStreamRef.current.write(\"robot_reset\");\r\n      console.log(\"Sent AI_MODE_OFF_SIGNAL.\");\r\n      setAiSuggestions([null, null]); // ææ¡ˆã‚’ã‚¯ãƒªã‚¢\r\n    }\r\n  }, [isAiModeOn, me, localDataStreamRef]); // isAiModeOn, me, localDataStreamRef ã®å¤‰æ›´ã«åå¿œ\r\n\r\n  /**\r\n   * AIãƒ¢ãƒ¼ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãƒãƒ³ãƒ‰ãƒ©\r\n   * ã“ã®é–¢æ•°ã¯AIãƒ¢ãƒ¼ãƒ‰ã®çŠ¶æ…‹ã‚’ãƒˆã‚°ãƒ«ã™ã‚‹ã®ã¿ã§ã€ã‚·ã‚°ãƒŠãƒ«é€ä¿¡ã¯useEffectã«ä»»ã›ã‚‹\r\n   */\r\n  /* eslint-disable */\r\n  const handleAiModeToggle = () => {\r\n    setIsAiModeOn(prev => !prev);\r\n  };\r\n  /* eslint-enable */\r\n\r\n  // ðŸŒŸè¿½åŠ : éŸ³å£°èªè­˜ã®é–‹å§‹ãƒ»åœæ­¢ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãƒãƒ³ãƒ‰ãƒ©\r\n  const handleToggleListening = () => {\r\n    if (!recognition.current) {\r\n      console.error(\"SpeechRecognition API is not initialized.\");\r\n      return;\r\n    }\r\n\r\n    if (isListening) {\r\n      // èªè­˜ã‚’åœæ­¢\r\n      recognition.current.stop();\r\n      console.log(\"Stopped speech recognition.\");\r\n    } else {\r\n      // èªè­˜ã‚’é–‹å§‹\r\n      recognition.current.start();\r\n      console.log(\"Started speech recognition.\");\r\n    }\r\n    setIsListening(!isListening);\r\n  };\r\n\r\n  return (\r\n    <div className=\"app-container\">\r\n      <div className=\"header\">\r\n      \r\n        <div className=\"header-left\">\r\n          <button className=\"motion-btn\" disabled={isAiModeOn || isMoveInProgress}>ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³</button>\r\n          {/* ç¿»è¨³ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹è¦ç´ ã‚’è¿½åŠ  */}\r\n          {translatedText && (\r\n            <div className=\"translated-text\">\r\n              <span className=\"translated-text-label\">ç¿»è¨³: </span>\r\n              <span className=\"translated-text-content\">{translatedText}</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div className=\"header-right\">\r\n            <div className=\"room-controls\">\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"ãƒ«ãƒ¼ãƒ åã‚’å…¥åŠ›\"\r\n              value={roomName}\r\n              onChange={(e) => setRoomName(e.target.value)}\r\n              className=\"room-input\"\r\n              disabled={!!me} // ãƒ«ãƒ¼ãƒ å‚åŠ ä¸­ã¯å…¥åŠ›ä¸å¯ã«ã™ã‚‹\r\n            />\r\n            {!me ? ( // ãƒ«ãƒ¼ãƒ ã«å‚åŠ ã—ã¦ã„ãªã„å ´åˆ\r\n              <button onClick={handleJoinRoom} className=\"join-room-btn\" disabled={!skywayContext || !roomName}>\r\n                ãƒ«ãƒ¼ãƒ ã«å‚åŠ \r\n              </button>\r\n            ) : ( // ãƒ«ãƒ¼ãƒ ã«å‚åŠ ã—ã¦ã„ã‚‹å ´åˆ\r\n              <button onClick={handleLeaveRoom} className=\"leave-room-btn\">\r\n                ãƒ«ãƒ¼ãƒ ã‚’é€€å‡º\r\n              </button>\r\n            )}\r\n          </div>\r\n          <button onClick={handleLogout} className=\"logout-btn\">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>\r\n          <button className=\"voice-btn\" disabled={isAiModeOn || isMoveInProgress}>ãƒœã‚¤ã‚¹</button>\r\n        </div>\r\n      </div>\r\n      <div className=\"main-container\">\r\n        <div className=\"side-panel\">\r\n          <div className=\"side-panel-content\">\r\n            {Object.keys(messages).slice(0, 14).map(key => ( // å·¦å´ã®ãƒœã‚¿ãƒ³æ•°ã‚’èª¿æ•´\r\n              <button\r\n                key={key}\r\n                // å·¦å´ã®ãƒœã‚¿ãƒ³ã¯ \"template_motion_ã€‡ã€‡\" å½¢å¼ã§é€ä¿¡\r\n                onClick={() => handleSend(`template_motion_${messages[key].japanese}`)}\r\n                className=\"side-btn\"\r\n                disabled={isAiModeOn || !me || isMoveInProgress} // AIãƒ¢ãƒ¼ãƒ‰ä¸­ã€æœªå‚åŠ ã€ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã¯ç„¡åŠ¹åŒ–\r\n              >\r\n                {messages[key].japanese} {/* å¸¸ã«æ—¥æœ¬èªžè¡¨ç¤º */}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n        <div className=\"main-area\">\r\n\r\n          <div className=\"robot-display\" ref={robotDisplayRef}>\r\n            {/* ãƒªãƒ¢ãƒ¼ãƒˆã®ãƒ“ãƒ‡ã‚ªã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒã“ã“ã«å‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ */}\r\n            {/* ãƒ«ãƒ¼ãƒ æƒ…å ±ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ã€ã“ã“ã§ã¯è¡¨ç¤ºã—ã¾ã›ã‚“ */}\r\n\r\n            {/* AIã‹ã‚‰ã®ææ¡ˆè¡¨ç¤º */}\r\n            {(aiSuggestions[0] || aiSuggestions[1]) && (\r\n              <div className=\"ai-suggestions\">\r\n                {aiSuggestions[0] && (\r\n                  <button\r\n                    onClick={() => handleSend(aiSuggestions[0])}\r\n                    className=\"ai-suggestion-btn\"\r\n                    disabled={isMoveInProgress} // ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã¯ç„¡åŠ¹åŒ–\r\n                  >\r\n                    {aiSuggestions[0].text}\r\n                  </button>\r\n                )}\r\n                {aiSuggestions[1] && (\r\n                  <button\r\n                    onClick={() => handleSend(aiSuggestions[1])}\r\n                    className=\"ai-suggestion-btn\"\r\n                    disabled={isMoveInProgress} // ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã¯ç„¡åŠ¹åŒ–\r\n                  >\r\n                    {aiSuggestions[1].text}\r\n                  </button>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n        <div className=\"side-panel right\">\r\n          <div className=\"side-panel-content\">\r\n            {Object.keys(messages).slice(14).map(key => ( // å³å´ã®ãƒœã‚¿ãƒ³æ•°ã‚’èª¿æ•´\r\n              <button\r\n                key={key}\r\n                // å³å´ã®ãƒœã‚¿ãƒ³ã¯ \"template_voice_ã€‡ã€‡\" å½¢å¼ã§é€ä¿¡\r\n                onClick={() => handleSend(`template_voice_${messages[key].japanese}`)}\r\n                className=\"side-btn\"\r\n                disabled={isAiModeOn || !me || isMoveInProgress} // AIãƒ¢ãƒ¼ãƒ‰ä¸­ã€æœªå‚åŠ ã€ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã¯ç„¡åŠ¹åŒ–\r\n              >\r\n                {messages[key].japanese} {/* å¸¸ã«æ—¥æœ¬èªžè¡¨ç¤º */}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className=\"bottom-controls\">\r\n        <button\r\n          className={`control-btn ai-btn`}\r\n          onClick={() => handleAiModeToggle()}\r\n          disabled={!me} // ãƒ«ãƒ¼ãƒ ã«å‚åŠ ã—ã¦ã„ãªã„å ´åˆã¯ç„¡åŠ¹\r\n        >\r\n          {isAiModeOn ? 'ãƒªã‚»ãƒƒãƒˆ   ' : 'AIãƒ¢ãƒ¼ãƒ‰ON'}\r\n        </button>\r\n        {/* ðŸŒŸè¿½åŠ : éŸ³å£°èªè­˜ãƒœã‚¿ãƒ³ */}\r\n        <button\r\n          className={`control-btn speech-recognition-btn ${isListening ? 'listening' : ''}`}\r\n          onClick={handleToggleListening}\r\n          disabled={!me || !localDataStreamRef.current || isAiModeOn} // ãƒ«ãƒ¼ãƒ æœªå‚åŠ ã€ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ æœªæº–å‚™ã€AIãƒ¢ãƒ¼ãƒ‰ä¸­ã¯ç„¡åŠ¹\r\n        >\r\n          {isListening ? 'ðŸ”´ éŸ³å£°èªè­˜ã‚’åœæ­¢' : 'ðŸŽ¤ éŸ³å£°èªè­˜ã‚’é–‹å§‹'}\r\n        </button>\r\n        <button\r\n          className={`control-btn mic-btn ${isMuted ? 'muted' : ''}`} // ãƒŸãƒ¥ãƒ¼ãƒˆçŠ¶æ…‹ã«å¿œã˜ã¦ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ \r\n          onClick={handleMute}\r\n          id=\"micBtn\"\r\n          disabled={!me || !audioPublicationRef.current || isAiModeOn} // ãƒ«ãƒ¼ãƒ ã«å‚åŠ ã—ã¦ã„ãªã„ã€ã¾ãŸã¯ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãŒå…¬é–‹ã•ã‚Œã¦ã„ãªã„ã€AIãƒ¢ãƒ¼ãƒ‰ä¸­ã¯ç„¡åŠ¹\r\n        >\r\n          {isMuted ? 'ðŸ”‡ ãƒžã‚¤ã‚¯ãƒŸãƒ¥ãƒ¼ãƒˆ' : 'ðŸŽ¤ ãƒžã‚¤ã‚¯ON'} {/* ãƒŸãƒ¥ãƒ¼ãƒˆçŠ¶æ…‹ã«å¿œã˜ã¦ã‚¢ã‚¤ã‚³ãƒ³ã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’å¤‰æ›´ */}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Home;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}